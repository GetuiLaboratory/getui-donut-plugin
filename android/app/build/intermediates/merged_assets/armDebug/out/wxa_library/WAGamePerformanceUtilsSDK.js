try{!function(){let e,t="getGamePerformanceUtilsSDKGlobalVar";globalThis[t]?e=globalThis[t]:void 0!==globalThis.WeixinJSBridge&&globalThis.WeixinJSBridge[t]&&(e=globalThis.WeixinJSBridge[t]);var{wxConsole:n}=e();(()=>{var e={34:e=>{function t(e,t,n,r,i,s,o){try{var a=e[s](o),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(r,i)}e.exports=function(e){return function(){var n=this,r=arguments;return new Promise((function(i,s){var o=e.apply(n,r);function a(e){t(o,i,s,a,l,"next",e)}function l(e){t(o,i,s,a,l,"throw",e)}a(void 0)}))}},e.exports.__esModule=!0,e.exports.default=e.exports}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var s=t[r]={exports:{}};return e[r](s,s.exports,n),s.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var r={};(()=>{"use strict";n.d(r,{default:()=>un});var e=n(34),t=n.n(e);class i{static getInstance(){return this.instance||(this.instance=new this),this.instance}}i.instance=void 0;var s,o,a,l,c=null;function h(e){if(e){var t=(c=e).getFileSystemManager();s=t.writeFile,o=t.unlink,a=c.getDeviceInfo(),l=c.getAppBaseInfo()}}function u(e){h(e)}function d(){return c}function f(){return a}function p(){return l}function m(e){return"number"==typeof e&&isFinite(e)}function g(e){return e.then((e=>[null,e])).catch((e=>[e,null]))}function v(e){if(null==e)return!0;if("boolean"==typeof e)return!1;if("number"==typeof e)return!e;if(e instanceof Error)return""===e.message;switch(Object.prototype.toString.call(e)){case"[object String]":case"[object Array]":return!e.length;case"[object File]":case"[object Map]":case"[object Set]":return!e.size;case"[object Object]":return!Object.keys(e).length}return!1}function I(e){return void 0===e}function y(e){var t=e;try{"object"==typeof e&&(t="string"==typeof e.errMsg?e.errMsg:"string"==typeof e.errmsg?e.errmsg:"string"==typeof e.message?e.message:JSON.stringify(e))}catch(e){console.error(e)}return t}const k=class extends i{constructor(...e){super(...e),this.frameInfo=void 0,this.frame=0,this.requestId=void 0,this.startTime=0,this.prevTime=0}get currentFrame(){return this.frame+1}init(){this.startTime=Date.now(),this.start()}getRuntime(){return Date.now()-this.startTime}start(){this.requestId||(this.prevTime=Date.now(),requestAnimationFrame(this.counter.bind(this)))}stop(){cancelAnimationFrame(this.requestId),this.requestId=0}reset(){this.stop(),this.requestId=0,this.startTime=0,this.prevTime=0,this.frameInfo=null}counter(){this.frame+=1;var e=Date.now(),t=e-this.prevTime;this.frameInfo={frame:this.frame,startTime:this.prevTime,endTime:e,cost:t},this.prevTime=e,this.requestId=requestAnimationFrame(this.counter.bind(this))}}.getInstance();var w=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},b=20;function T(){this._events={},this._conf&&S.call(this,this._conf)}function S(e){e?(this._conf=e,e.delimiter&&(this.delimiter=e.delimiter),this._maxListeners=void 0!==e.maxListeners?e.maxListeners:b,e.newListener&&(this._newListener=e.newListener),e.removeListener&&(this._removeListener=e.removeListener)):this._maxListeners=b}function R(e,t){console.warn(`[Event] ${e} listeners of event ${t} have been added, possibly causing memory leak.`)}function C(e){this._events={},this._newListener=!1,this._removeListener=!1,S.call(this,e)}C.prototype.delimiter=".",C.prototype.setMaxListeners=function(e){void 0!==e&&(this._maxListeners=e,this._conf||(this._conf={}),this._conf.maxListeners=e)},C.prototype.event="",C.prototype.once=function(e,t){return this._once(e,t,!1)},C.prototype.prependOnceListener=function(e,t){return this._once(e,t,!0)},C.prototype._once=function(e,t,n){return this._many(e,1,t,n),this},C.prototype.many=function(e,t,n){return this._many(e,t,n,!1)},C.prototype.prependMany=function(e,t,n){return this._many(e,t,n,!0)},C.prototype._many=function(e,t,n,r){var i=this;if("function"!=typeof n)throw new Error("many only accepts instances of Function");function s(){return 0==--t&&i.off(e,s),n.apply(this,arguments)}return s._origin=n,this._on(e,s,r),i},C.prototype.emit=function(){this._events||T.call(this);var e=arguments[0];if("newListener"===e&&!this._newListener&&!this._events.newListener)return!1;var t,n,r,i,s,o=arguments.length;if(this._all&&this._all.length){if(s=this._all.slice(),o>3)for(t=new Array(o),i=0;i<o;i++)t[i]=arguments[i];for(r=0,n=s.length;r<n;r++)switch(this.event=e,o){case 1:s[r].call(this,e);break;case 2:s[r].call(this,e,arguments[1]);break;case 3:s[r].call(this,e,arguments[1],arguments[2]);break;default:s[r].apply(this,t)}}if("function"==typeof(s=this._events[e])){switch(this.event=e,o){case 1:s.call(this);break;case 2:s.call(this,arguments[1]);break;case 3:s.call(this,arguments[1],arguments[2]);break;default:for(t=new Array(o-1),i=1;i<o;i++)t[i-1]=arguments[i];s.apply(this,t)}return!0}if(s&&(s=s.slice()),s&&s.length){if(o>3)for(t=new Array(o-1),i=1;i<o;i++)t[i-1]=arguments[i];for(r=0,n=s.length;r<n;r++)switch(this.event=e,o){case 1:s[r].call(this);break;case 2:s[r].call(this,arguments[1]);break;case 3:s[r].call(this,arguments[1],arguments[2]);break;default:s[r].apply(this,t)}return!0}if(!this._all&&"error"===e)throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");return!!this._all},C.prototype.emitAsync=function(){this._events||T.call(this);var e=arguments[0];if("newListener"===e&&!this._newListener&&!this._events.newListener)return Promise.resolve([!1]);var t,n,r,i,s,o=[],a=arguments.length;if(this._all){if(a>3)for(t=new Array(a),i=1;i<a;i++)t[i]=arguments[i];for(r=0,n=this._all.length;r<n;r++)switch(this.event=e,a){case 1:o.push(this._all[r].call(this,e));break;case 2:o.push(this._all[r].call(this,e,arguments[1]));break;case 3:o.push(this._all[r].call(this,e,arguments[1],arguments[2]));break;default:o.push(this._all[r].apply(this,t))}}if("function"==typeof(s=this._events[e]))switch(this.event=e,a){case 1:o.push(s.call(this));break;case 2:o.push(s.call(this,arguments[1]));break;case 3:o.push(s.call(this,arguments[1],arguments[2]));break;default:for(t=new Array(a-1),i=1;i<a;i++)t[i-1]=arguments[i];o.push(s.apply(this,t))}else if(s&&s.length){if(s=s.slice(),a>3)for(t=new Array(a-1),i=1;i<a;i++)t[i-1]=arguments[i];for(r=0,n=s.length;r<n;r++)switch(this.event=e,a){case 1:o.push(s[r].call(this));break;case 2:o.push(s[r].call(this,arguments[1]));break;case 3:o.push(s[r].call(this,arguments[1],arguments[2]));break;default:o.push(s[r].apply(this,t))}}else if(!this._all&&"error"===e)return arguments[1]instanceof Error?Promise.reject(arguments[1]):Promise.reject("Uncaught, unspecified 'error' event.");return Promise.all(o)},C.prototype.on=function(e,t){return this._on(e,t,!1)},C.prototype.prependListener=function(e,t){return this._on(e,t,!0)},C.prototype.onAny=function(e){return this._onAny(e,!1)},C.prototype.prependAny=function(e){return this._onAny(e,!0)},C.prototype.addListener=C.prototype.on,C.prototype._onAny=function(e,t){if("function"!=typeof e)throw new Error("onAny only accepts instances of Function");return this._all||(this._all=[]),t?this._all.unshift(e):this._all.push(e),this},C.prototype._on=function(e,t,n){if("function"==typeof e)return this._onAny(e,t),this;if("function"!=typeof t)throw new Error("on only accepts instances of Function");return this._events||T.call(this),this._newListener&&this.emit("newListener",e,t),this._events[e]?("function"==typeof this._events[e]&&(this._events[e]=[this._events[e]]),n?this._events[e].unshift(t):this._events[e].push(t),!this._events[e].warned&&this._maxListeners>0&&this._events[e].length>this._maxListeners&&(this._events[e].warned=!0,R.call(this,this._events[e].length,e))):this._events[e]=t,this},C.prototype.off=function(e,t){if("function"!=typeof t)throw new Error("removeListener only takes instances of Function");var n,r=[];if(!this._events[e])return this;n=this._events[e],r.push({_listeners:n});for(var i=0;i<r.length;i++){if(n=r[i]._listeners,w(n)){for(var s=-1,o=0,a=n.length;o<a;o++)if(n[o]===t||n[o].listener&&n[o].listener===t||n[o]._origin&&n[o]._origin===t){s=o;break}if(s<0)continue;return this._events[e].splice(s,1),0===n.length&&delete this._events[e],this._removeListener&&this.emit("removeListener",e,t),this}(n===t||n.listener&&n.listener===t||n._origin&&n._origin===t)&&(delete this._events[e],this._removeListener&&this.emit("removeListener",e,t))}return function e(t){if(void 0!==t){var n=Object.keys(t);for(var r in n){var i=n[r],s=t[i];s instanceof Function||"object"!=typeof s||null===s||(Object.keys(s).length>0&&e(t[i]),0===Object.keys(s).length&&delete t[i])}}}(this.listenerTree),this},C.prototype.offAny=function(e){var t,n=0,r=0;if(e&&this._all&&this._all.length>0){for(n=0,r=(t=this._all).length;n<r;n++)if(e===t[n])return t.splice(n,1),this._removeListener&&this.emit("removeListenerAny",e),this}else{if(t=this._all,this._removeListener)for(n=0,r=t.length;n<r;n++)this.emit("removeListenerAny",t[n]);this._all=[]}return this},C.prototype.removeListener=C.prototype.off,C.prototype.removeAllListeners=function(e){return void 0===e?(!this._events||T.call(this),this):(this._events&&delete this._events[e],this)},C.prototype.listeners=function(e){return this._events||T.call(this),this._events[e]||(this._events[e]=[]),w(this._events[e])||(this._events[e]=[this._events[e]]),this._events[e]},C.prototype.eventNames=function(){return Object.keys(this._events)},C.prototype.listenerCount=function(e){return this.listeners(e).length},C.prototype.listenersAny=function(){return this._all?this._all:[]};const P=new C;var _={LoadStart:"wx-request-load-start",LoadFail:"wx-reqeust-load-fail",LoadSuccess:"wx-request-load-success",LoadComplete:"wx-request-load-complete"},L="detect-start",x="detect-end",N="detect-before-result",E="performance-data-received",A="canvas-drawcall",q={Invoked:"api-invoked",ReportInteraction:"report-interaction",JsError:"on-js-error",UnhandledPromiseRejection:"unhandled-promise-rejection"};const F=["getStorageSync","readFileSync","fs_appendFileSync","measureText","createAudioInstance","loadLibFiles","setDisplayOrientation","restoreWebviewFocus","getPublicLibVersion","getCurrentRoute","enableDeviceOrientationChangeListening","setStorageSync","writeFileSync","createLoadSubPackageTask","initReadyForPrerender","unlinkSync","statSync","initReady","isdirSync","createDownloadTask","getStorageInfoSync","getBackgroundAudioState","removeStorageSync","accessSync","exitMiniProgram","initReadyAfterRenderingCache","readdirSync","readCompressedFileSync","clearStorageSync","saveFileSync","getSystemInfoSync","mkdirSync","canvasToTempFilePathSync","rmdirSync","loadWAFileSync","fs_renameSync","markScene","getSelectedTextRange","fs_copyFileSync","createUploadTask","createSocketTask","getPluginPermissionBytes","getPermissionBytes","measureTextString","isGameRecorderSupported","getABTestConfig","createRequestTask","createRequestTaskAsync","openSystemSetting","getMenuButtonBoundingClientRect","remoteDebugInfo","getSystemInfo","sync_jsapi_end","getStorage","setStorage","bindUDPSocket","sendDataToH5","createBufferURL","revokeBufferURL"];function D(e,t){return e?e[t]||e[t.toLowerCase()]:""}function M(e,t){var n=null;for(var r of e.children){var i;if((null==r||null===(i=r.attributes)||void 0===i?void 0:i.id)===t){n=r;break}if(r.children.length>0){var s=M(r,t);if(null!==s){n=s;break}}}return n}function O(e,t=[]){var n=new WeakMap,r=JSON.stringify(e,((e,r)=>{if(!t.includes(e)){var i=r&&r.buffer instanceof ArrayBuffer&&void 0!==r.BYTES_PER_ELEMENT;if(!("function"==typeof r||Array.isArray(r)||r instanceof ArrayBuffer||i||r instanceof Map||r instanceof Set)){if("object"==typeof r&&null!==r){if(n.has(r))return;n.set(r,!0)}return r}}}));return"{}"===r?"":r}function W(e){return e>=200&&e<300}class j{constructor(e){var t;this.invokeInfo=void 0,this.args=null,this.result=null,this.isSyncApi=!1,this.ret=null,this.recorded=!1;var{apiName:n,args:r}=e,i=Date.now(),s=Math.random();this.args=r,this.invokeInfo={frame:k.currentFrame,uniqueId:1e4*i+Math.round(9999*s),startTime:i,endTime:0,args:null==r||null===(t=r.map((e=>O(e))))||void 0===t?void 0:t.filter((e=>!!e)),apiName:n,errno:0,invokeCost:0,callbackDuration:0,errMsg:"",isSyncApi:this.checkIsSyncApi(n)}}afterExecute(e){e&&(this.ret=e),this.invokeInfo.invokeCost=Date.now()-this.invokeInfo.startTime,this.isSyncApi&&this.sendMessage()}complete(e){var{endTime:t}=this.invokeInfo;if(!t){var n=Date.now();this.invokeInfo.endTime=n,this.invokeInfo.callbackDuration=n-this.invokeInfo.startTime}this.result||(this.result=e);var{errMsg:r,errno:i}=e;r&&!r.includes(":ok")&&(this.invokeInfo.errMsg=r,this.invokeInfo.errno=I(i)?1:i),this.isSyncApi||this.sendMessage()}sendMessage(){this.recorded||(this.recorded=!0,P.emit(q.Invoked,this))}checkIsSyncApi(e){return e.toLowerCase().endsWith("sync")&&!e.toLowerCase().endsWith("async")||(null==F?void 0:F.includes(e))}}var G=function(e){return e[e.None=0]="None",e[e.Event=1]="Event",e[e.Error=2]="Error",e[e.Warn=3]="Warn",e[e.Info=4]="Info",e[e.Debug=5]="Debug",e}(G||{});class U{static error(...e){U.logLevel>=G.Error&&console.error("[DETECT ERROR]",...e)}static warn(...e){U.logLevel>=G.Warn&&console.warn("[DETECT WARN]",...e)}static info(...e){U.logLevel>=G.Info&&console.info("[DETECT INFO]",...e)}static event(...e){U.logLevel>=G.Event&&console.info("[DETECT EVENT]",...e)}static debug(...e){U.logLevel>=G.Debug&&console.log("[DETECT DEBUG]",...e)}static setLogLevel(e){U.logLevel=e}static getLogLevel(){return U.logLevel}}U.logLevel=G.Warn;var V=class extends i{constructor(...e){super(...e),this.injectTime=0,this.detectTimes=0,this.showTimes=0,this.lastTimeStamp=0,this.initParams=void 0,this.isWxApplib=!1,this.sdk={},this.meta={startTime:0,endTime:0,uploadTime:0},this.defaultMaxConcurrent=10,this.onShow=()=>{this.showTimes+=1,U.debug("return front end after ",Date.now()-this.lastTimeStamp," ms"),this.lastTimeStamp=0},this.onHide=()=>{this.lastTimeStamp=Date.now()}}get hasWXConfig(){return this.isWxApplib&&this.sdk.WXConfig}get audits(){return this.hasWXConfig&&this.sdk.WXConfig.audits||{}}get iOSHighPerformance(){return!!this.hasWXConfig&&(!!this.sdk.WXConfig.jitMode||!!this.sdk.WXConfig.iOSHighPerformance)}get maxConcurrentCount(){var e;return this.hasWXConfig&&(null===(e=this.sdk.WXConfig.wxAppInfo)||void 0===e?void 0:e.maxRequestConcurrent)||this.defaultMaxConcurrent}get subpackages(){return this.hasWXConfig?this.sdk.WXConfig.subpackages:[]}get parallelPreloadSubpackages(){return this.hasWXConfig?this.sdk.WXConfig.parallelPreloadSubpackages:[]}get isIOS(){return"ios"===this.sdk.WXConfig.platform}get isDevtools(){return"devtools"===this.sdk.WXConfig.platform}get isAndroid(){return"android"===this.sdk.WXConfig.platform}init(e){if(this.initParams=e,this.injectTime=Date.now(),void 0!==this.initParams.WXConfig){this.isWxApplib=!0;var t=e;this.sdk={WXConfig:t.WXConfig,wxConsole:t.wxConsole,onShow:t.onShow,onHide:t.onHide,offShow:t.offShow,offHide:t.offHide,getSystemInfoSync:t.getSystemInfoSync,getNetworkType:t.getNetworkType,onNetworkStatusChange:t.onNetworkStatusChange,gameTransfer:t.gameTransfer,reportKeyValue:t.reportKeyValue}}else this.isWxApplib=!1;this.bindVisibleListener()}reset(){this.detectTimes=0,this.showTimes=0,this.meta={startTime:0,endTime:0,uploadTime:0},this.removeVisibleListener()}bindVisibleListener(){this.sdk.onShow&&(this.sdk.onShow(this.onShow),this.sdk.onHide(this.onHide))}removeVisibleListener(){this.sdk.offShow&&(this.sdk.offShow(this.onShow),this.sdk.offHide(this.onHide))}}.getInstance(),B=new WeakMap;var K=new class{get requestingCount(){return this.networkInfo.requestingCount}get needPushQueue(){var{requestingCount:e,maxConcurrent:t}=this.networkInfo;return e>t}constructor(){this.networkInfo=void 0,this.reset()}reset(){this.networkInfo={invokeCount:0,failCount:0,responseSize:0,requestingCount:0,requestStartTime:0,totalNetworkTime:0,maxConcurrent:V.maxConcurrentCount,totalQueueCount:0,totalQueueTime:0}}loadStart(e){hn.isRunning&&(0===this.networkInfo.requestingCount&&(this.networkInfo.requestStartTime=Date.now()),this.networkInfo.requestingCount+=1,this.networkInfo.invokeCount+=1,this.needPushQueue&&(this.networkInfo.totalQueueCount+=1,B.set(e,[Date.now()])))}loadSuccess(e){hn.isRunning&&this.handleInfo(e)}loadFail(e){hn.isRunning&&(this.networkInfo.failCount+=1,this.handleInfo(e))}handleInfo(e){var{networkInfo:t}=e,n=e.result;if(this.networkInfo.requestingCount>0){if(this.networkInfo.requestingCount-=1,0===this.networkInfo.requestingCount){var r=Date.now()-this.networkInfo.requestStartTime;this.networkInfo.totalNetworkTime+=r,U.debug("all network finished, cost=",r,", total=",this.networkInfo.totalNetworkTime)}this.networkInfo.responseSize+=t.byteLength,n&&!W(n.statusCode)&&(U.error("network task statusCode error, statusCode=",n.statusCode,", url=",e.networkInfo.url),this.networkInfo.failCount+=1),this.calculateQueueTime(e),U.debug("network task complete, currentInfo=",JSON.parse(JSON.stringify(this.networkInfo)))}}calculateQueueTime(e){var t=e.invokeInfoMap.get(e);if(t){var n=(B.get(t)||[])[0];if(n&&n>0){var r=Date.now()-n;B.set(t,[n,r]),this.networkInfo.totalQueueTime+=r}}}},$={Request:"request",DownloadFile:"downloadFile",CreateImage:"createImage",CreateCanvas:"createCanvas",ReportScene:"reportScene",OnError:"onError",OnUnhandledRejection:"onUnhandledRejection"},H={Env:"env",Cloud:"cloud"};class J{constructor(e){this.type=void 0,this.networkInfo=void 0,this.invokeInfoMap=new WeakMap,this.result=void 0,this.needPushQueue=!1;var{generalInvokeInfo:t,type:n,args:r={}}=e,{url:i}=r;this.type=n,this.invokeInfoMap.set(this,t),t.result&&(this.result=t.result),this.networkInfo={url:i,byteLength:0,currentConcurrentCount:K.requestingCount,params:O(r,["data"]),statusCode:0,method:r.method,protocol:"",contentEncoding:"",cache:!0,queueTime:0},this.needPushQueue=K.needPushQueue}complete(){var e=this.invokeInfoMap.get(this);e&&(e.result&&(this.result=e.result,this.networkInfo.statusCode=this.result.statusCode,this.networkInfo.protocol=this.result.profile?this.result.profile.protocol:"",this.type===$.Request?this.checkRequest():this.type===$.DownloadFile&&this.setResponseSize(this.result),this.calculateQueueTime(e)),this.type===$.CreateImage&&(this.networkInfo.statusCode=200))}calculateQueueTime(e){if(this.needPushQueue){var{profile:t}=e.result;t&&(this.networkInfo.queueTime=t.fetchStart-e.invokeInfo.startTime)}}checkRequest(){var e=this.result;W(e.statusCode)&&(this.checkHeader(e.header),this.setResponseSize(e))}checkHeader(e){e&&(this.networkInfo.contentEncoding=D(e,"Content-Encoding"),this.networkInfo.cache=this.checkCache(e),this.networkInfo.byteLength=parseInt(D(e,"Content-Length"),10)||0)}checkCache(e){var t=!0;if(e){var n=D(e,"X-Cache-Lookup")||D(e,"X-Cache"),r=D(e,"Age"),i=(n||"").toLowerCase();i?t=i.includes("hit"):r&&(t=Number(r)>0)}return t}setResponseSize(e){var{profile:t}=e,n=this.networkInfo.byteLength;return t?n=t.receivedBytedCount:this.type===$.Request&&(n=this.getResponseSizeByBody(e)),this.networkInfo.byteLength=n,n}getResponseSizeByBody(e){var t,{data:n}=e,r=0;return t=n,"[object String]"===Object.prototype.toString.call(t)?r=n.length:n&&n.byteLength&&(r=n.byteLength),r}}class X{constructor(e){this.performanceInfo=void 0;var t=Date.now(),n=Math.random();this.performanceInfo={...e,uniqueId:1e4*t+Math.round(9999*n),frame:k.currentFrame,startTime:t,endTime:t}}}function Q(e,t,n,...r){var i,s,o=new j({apiName:e,args:r}),a=null==r?void 0:r[0];if(a){var l=null==a?void 0:a.success;l&&(a.success=function(e){var t,r;o.complete(e),null==n||null===(t=n.success)||void 0===t||t.call(n,o),"function"==typeof l&&l(e),null==n||null===(r=n.afterSuccess)||void 0===r||r.call(n,o)});var c=null==a?void 0:a.fail;c&&(a.fail=function(e){var t,r;o.complete(e),null==n||null===(t=n.fail)||void 0===t||t.call(n,o),"function"==typeof c&&c(e),null==n||null===(r=n.afterFail)||void 0===r||r.call(n,o)});var h=null==a?void 0:a.complete;h&&(a.complete=function(e){var t,r;o.complete(e),null==n||null===(t=n.complete)||void 0===t||t.call(n,o),"function"==typeof h&&h(e),null==n||null===(r=n.afterComplete)||void 0===r||r.call(n,o)})}null==n||null===(i=n.beforeExecute)||void 0===i||i.call(n,o);var u=t(...r);return o.ret=u,null==n||null===(s=n.afterExecute)||void 0===s||s.call(n,o),o.afterExecute(u),u}var z=new WeakMap;var Y=new WeakMap;var Z=new WeakMap,ee=new WeakMap,te=Object.prototype.__defineGetter__,ne=Object.prototype.__defineSetter__,re=Object.defineProperty,ie=(e,t,n)=>{te.call(e,t,n)},se=(e,t,n)=>{ne.call(e,t,n)},oe=function(){["width","height","complete"].forEach((e=>{ie(this,e,(function(){var t=Z.get(this);return null==t?void 0:t[e]})),se(this,e,(function(t){var n=Z.get(this);n&&(n[e]=t)}))})),["onload","onerror"].forEach((e=>{ie(this,e,(()=>this[`__original__${e}`])),se(this,e,(function(t){var n,r=Z.get(this);r&&(r[e]=null==t||null===(n=t.bind)||void 0===n?void 0:n.call(t,this));re(this,`__original__${e}`,{value:t,writable:!0,configurable:!0,enumerable:!1})}))})),this.tagName="IMG",this.nodeName="IMG"};class ae{constructor(e){Z.set(this,e),this.__image__=!0,oe.call(this)}addEventListener(...e){var t=Z.get(this);t&&t.addEventListener(...e)}removeEventListener(...e){var t=Z.get(this);t&&t.removeEventListener(...e)}}function le(e){var t=Z.get(this);if(t){t.src=e;var n=ee.get(this);n&&(n(e),ee.delete(this))}}var ce=!1,he=e=>function(){var t=e(),n=new ae(t);return ce||(n.__proto__.__defineGetter__("src",(function(){var e=Z.get(this);return null==e?void 0:e.src})),n.__proto__.__defineSetter__("src",le),ce=!0),n},ue=new WeakMap;function de(){var e=d(),t=$.CreateImage,n=e.createImage;Reflect.defineProperty(e,t,{value(){var e,r,i,s=Q(t,he(n),{beforeExecute:t=>{e=t},afterExecute:t=>{e=t}});return r=s,i=t=>{!function(e,t){if(t&&t.includes("http")){var n=$.CreateImage;K.loadStart(e);var r=new J({generalInvokeInfo:e,apiName:n,args:void 0,type:$.CreateImage});r.networkInfo.url=t,ue.set(e,r),U.debug(`before ${n} execute, invokeInfo=`,e,", networkInfo=",r.networkInfo),P.emit(_.LoadStart,{generalNetworkInfo:r})}}(e,t),function(e,t,n){var r=e.onload;e.onload=function(...i){if(t&&t.includes("http")){U.debug("image, src=",t,", onload");var s=ue.get(n);s&&(s.complete(),U.debug("image network info=",s),K.loadSuccess(s))}r&&r.apply(e,i)};var i=e.onerror;e.onerror=function(...r){if(t&&t.includes("http")){var s=ue.get(n);s&&K.loadFail(s),U.error("image, src=",t,", onerror",...r)}i&&i.apply(e,r)}}(s,t,e)},i&&ee.set(r,i),s},configurable:!0})}var fe=!1;function pe(){var e=d(),t=$.CreateCanvas,n=e.createCanvas;Object.defineProperties(e,{[t]:{value:()=>Q(t,n,{afterExecute:e=>{var{ret:t}=e;fe||(fe=!0);var n=t.getContext;t.getContext=function(e,r){var i=n.apply(t,[e,r]);return"2d"===e&&function(e){var t,n,r,i,s=["drawImage"],o=["fillText","strokeText"],a=["fillRect","strokeRect","beginPath","closePath","moveTo","lineTo","arc","quadraticCurveTo","clip"],l=null===(t=V.audits)||void 0===t||null===(n=t.rules)||void 0===n?void 0:n.disableFillText,c=null===(r=V.audits)||void 0===r||null===(i=r.rules)||void 0===i?void 0:i.disableCreateImage;!I(l)&&l||a.push(...o);!I(c)&&c||a.push(...s);s.forEach((t=>{var n=e[t];Reflect.defineProperty(e,t,{value:(...r)=>"drawImage"===t?function(e,t){return(...n)=>{var r;null!=n&&null!==(r=n[0])&&void 0!==r&&r.__image__&&(n[0]=Z.get(n[0])),t.call(e,...n)}}(e,n).apply(e,r):n.apply(e,r),configurable:!0})}))}(i),"webgl"!==e&&"webgl2"!==e||function(e,t){var n,r,i=["drawArrays","drawElements"];if("webgl2"===t){var s=["drawElementsInstanced","drawArraysInstanced"];i.push(...s)}var o=null===(n=V.audits)||void 0===n||null===(r=n.rules)||void 0===r?void 0:r.disableCreateImage;!I(o)&&o||function(e,t){var n=["texImage2D","texSubImage2D","compressedTexImage2D","compressedTexSubImage2D"],r=["texImage3D","texSubImage3D","compressedTexImage3D","compressedTexSubImage3D"];"webgl2"===t&&n.push(...r);var i=Object.create(null);n.forEach((t=>{var n=e[t];i[t]={value:(...t)=>(t&&(t[5]&&t[5].__image__&&(t[5]=Z.get(t[5])),t[6]&&t[6].__image__&&(t[6]=Z.get(t[6])),t[7]&&t[7].__image__&&(t[7]=Z.get(t[7])),t[8]&&t[8].__image__&&(t[8]=Z.get(t[8]))),n.apply(e,t)),configurable:!0},Object.defineProperties(e,i)}))}(e,t)}(i,e),i}}}),configurable:!0}})}var me=(e,t,n=!0)=>{var r=e;n&&(r.on("touchstart",(()=>{r.style.opacity=.5})),r.on("touchend",(()=>{r.style.opacity=1}))),r.on("click",(e=>{(e=>{var t=e.absoluteX,n=e.absoluteY,r=e.absoluteEndX,i=e.absoluteEndY,s=e.pressInterval,o=!1;return Math.abs(i-n)<30&&Math.abs(r-t)<30&&s<300&&(o=!0),o})(e)&&t()}))};var ge,ve,Ie,ye,ke=32,we={body:{zIndex:1000009,position:"absolute",overflow:"visible",hidden:!1,width:76,height:ke,top:200,left:0},container:{position:"absolute",overflow:"visible",hidden:!1,width:76,height:ke,backgroundColor:"#00000080",borderRadius:16},operateBtn:{position:"absolute",left:24,top:0,width:44,height:ke,lineHeight:ke,textAlign:"center",color:"#ffffff",fontSize:11},stopIcon:{position:"absolute",width:7.5,height:12.5,left:9.83,top:9.75,hidden:!0},startIcon:{position:"absolute",width:10.82,height:12.13,top:9.4,left:9,hidden:!0},touchMask:{zIndex:1000009,position:"absolute",overflow:"hidden",hidden:!1,width:76,height:ke,backgroundColor:"rgba(0, 0, 0, 0)"}},be={Launch:"auditStart",End:"auditEnd",WriteReport:"writeReport",UploadReport:"uploadReport",AddEveluationReport:"addEveluationReport",OnHide:"onHide",OnShow:"onShow",RemoveReportFile:"removeReportFile",GetAuthToken:"getAuthToken"},Te={Self:0,Devtools:1};class Se{static start(e){if(!Se.timeMap.has(e)){var t=Date.now();return Se.timeMap.set(e,t),t}return 0}static timeEnd(e){if(Se.timeMap.has(e)){var t=Date.now(),n=Se.timeMap.get(e);return Se.timeMap.delete(e),t-n}return 0}}Se.timeMap=new Map,function(e){e[e.Front=1]="Front",e[e.Background=2]="Background"}(ge||(ge={})),function(e){e[e.Default=0]="Default",e[e.GameTransfer=1]="GameTransfer",e[e.Request=2]="Request",e[e.DownloadFile=3]="DownloadFile",e[e.CgiSpeedMeasure=4]="CgiSpeedMeasure",e[e.BadJs=5]="BadJs",e[e.Init=6]="Init",e[e.CostTime=7]="CostTime",e[e.Error=8]="Error",e[e.UploadFile=9]="UploadFile",e[e.Login=10]="Login",e[e.WebTransfer=11]="WebTransfer"}(ve||(ve={})),function(e){e[e.Info=101]="Info",e[e.Warn=102]="Warn",e[e.Error=103]="Error"}(Ie||(Ie={})),function(e){e.GameTransferReport="GameTransferReport",e.KeyValueReport="KeyValueReport",e.WxRequestReport="WxRequestReport"}(ye||(ye={}));var Re,Ce,Pe=Object.values(ve).filter((e=>m(e)));!function(e){e.STRING="STRING",e.LONGLONG="LONGLONG",e.UINT="UINT",e.INT="INT"}(Re||(Re={})),function(e){e.SvrReport="SvrReport",e.KvStat="KvStat"}(Ce||(Ce={}));var _e={[Re.STRING]:e=>"string"==typeof e&&e.length<=1024,[Re.LONGLONG]:e=>"number"==typeof e&&Math.floor(e)===e,[Re.UINT]:e=>"number"==typeof e&&Math.floor(e)===e&&e>=0,[Re.INT]:e=>"number"==typeof e&&Math.floor(e)===e};class Le{constructor({logid:e,schemas:t={},base:n,debug:r=!1,namespace:i="",skipValidateInProdEnv:s=!0}){this.debug=!1,this.base={},this.namespace="",this.skipValidateInProdEnv=!0,this.asyncGetBase=()=>Promise.resolve({}),this.logid=e,this.schemas=t,n&&this.setBase(n),this.debug=r,this.skipValidateInProdEnv=s,this.namespace=i?` ${i} `:" "}setBase(e){this.validate(e),this.base=Object.assign(Object.assign({},this.base),e)}validate(e){if((this.debug||!this.skipValidateInProdEnv)&&Object.keys(this.schemas).length)for(var[t,n]of Object.entries(e))if(void 0!==n){var r=this.schemas[t];r?this.validateColumn(r,n)||console.error(`[minigamefe${this.namespace}SchemaValidator]: logid ${this.logid}: ${t} should be ${r}, but now ${n}`):console.warn(`[minigamefe${this.namespace}SchemaValidator]: logid${this.logid}: ${t} 缺少类型定义`)}}validateColumn(e,t){return _e[e](t)}}var xe="";var Ne,Ee,Ae,qe,Fe,De={19283:"GameComponent",19335:"GameWhatsNew",20285:"MidasFriendPayment",21494:"WXGameWASMLaunchClose",21493:"WXGameWASMLaunchException",21492:"WXGameWASMLaunchTime",21898:"GameLifeMiniGameCardAction",20267:"GameAdsSkipCard"};class Me extends Le{constructor({reportFunc:e,logid:t,protocolParams:n,schemas:r,base:i,asyncGetBase:s=()=>Promise.resolve({}),debug:o,namespace:a="",skipValidateInProdEnv:l=!0}){var c=t;"number"==typeof t&&De[t]&&(c=De[t],o&&console.warn(`[minigamefe${a?` ${a} `:" "}KeyValueReporter]: logid ${t} auto map to ${c}!`)),super({logid:c,schemas:r,base:i,debug:o,namespace:a,skipValidateInProdEnv:l}),this.asyncGetBase=s,e||console.error(`[minigamefe${this.namespace}KeyValueReporter]: 未传入上报函数。`),this.reportFunc=e||function(){},this.protocolParams=n,this.sendCbk=null}setAppInfoBase(e){Object.assign(this.schemas,{AppId:Re.STRING,AppVersion:Re.UINT,AppState:Re.UINT}),this.protocolParams.unshift("AppId","AppVersion","AppState"),this.setBase(e)}send(e,t){var n;n=Array.isArray(e)?e:[e],this.asyncGetBase().then((e=>{this.setBase(e),n.forEach((e=>{var n=Object.assign(Object.assign({},this.base),e);this.validate(n);var r=[];this.protocolParams.forEach((e=>{var t=void 0!==n[e]?n[e]:"";r.push(t)})),this.reportFunc({key:this.logid,value:r.map(encodeURIComponent).join(","),immediately:!0});var i=t||this.sendCbk;(i&&i(this.logid,r.map(encodeURIComponent).join(",")),this.debug)&&(n.IsError?console.error:console.log)(`[minigamefe${this.namespace}keyValueReport]: ${this.logid}`,n)}))}))}}!function(e){e.devtools="devtools",e.android="android",e.ios="ios",e.windows="windows",e.mac="mac"}(Ne||(Ne={})),function(e){e.portrait="portrait",e.landscape="landscape",e.landscapeLeft="landscapeLeft",e.landscapeRight="landscapeRight"}(Ee||(Ee={})),function(e){e.DEVELOP="develop",e.TRIAL="trial",e.RELEASE="release"}(Ae||(Ae={})),function(e){e[e.release=1]="release",e[e.develop=2]="develop",e[e.trial=3]="trial"}(qe||(qe={})),function(e){e[e.Android=0]="Android",e[e.IOSJscore=1]="IOSJscore",e[e.IOSWK=2]="IOSWK",e[e.UnKnow=3]="UnKnow",e[e.PC=4]="PC",e[e.Devtools=5]="Devtools",e[e.IPadJscore=6]="IPadJscore",e[e.IPadWK=7]="IPadWK"}(Fe||(Fe={}));class Oe extends Le{constructor({reportFunc:e,logid:t,schemas:n={},base:r,reportType:i,asyncGetBase:s=()=>Promise.resolve({}),debug:o,namespace:a="",skipValidateInProdEnv:l=!0}){super({logid:t,schemas:n,base:r,debug:o,namespace:a,skipValidateInProdEnv:l}),this.reportType=Ce.SvrReport,this.asyncGetBase=s,e||console.error(`[minigamefe${this.namespace}GameTransferReport]: 未传入上报函数。`),this.reportFunc=e,void 0!==i&&(this.reportType=i)}setKvStatBase(e,t){if(this.reportType===Ce.KvStat){var n=(e.system||"").split(" ");Object.assign(this.schemas,{DeviceModel:Re.STRING,DeviceBrand:Re.STRING,OsName:Re.STRING,OsVersion:Re.STRING,LanguageVersion:Re.STRING,Count:Re.UINT,AppId:Re.STRING,AppVersion:Re.UINT,AppState:Re.UINT}),this.setBase({DeviceModel:e.model||"",DeviceBrand:e.brand||"",OsName:n[0]||"",OsVersion:n[1]||"",LanguageVersion:e.language||"",Count:1}),(null==t?void 0:t.miniProgram)&&this.setBase({AppState:qe[t.miniProgram.envVersion]||qe.release,AppId:t.miniProgram.appId,AppVersion:0})}}send(e,t){if(this.reportFunc&&"function"==typeof this.reportFunc){var n,r=[],i=this.logid;n=Array.isArray(e)?e:[e],this.asyncGetBase().then((e=>{this.setBase(e),n.forEach((e=>{var t=Object.assign(Object.assign({},this.base),e);if(t.ExternInfo&&"object"==typeof t.ExternInfo&&this.schemas.ExternInfo===Re.STRING&&(t.ExternInfo=encodeURIComponent(JSON.stringify(t.ExternInfo))),this.validate(t),this.reportType===Ce.KvStat){var n=Math.floor(Date.now()/1e3);Object.assign(t,{StartTime:n,EndTime:n})}var s={log_id:this.logid,custom_data:t};r.push(s),this.debug&&console.log(`[minigamefe${this.namespace}GameTransferReport]: ${i},`,t)}));var s={report_list:r};this.reportFunc({req_path:"comm_datareport",json_data:JSON.stringify(s),success(){t&&t(i,JSON.stringify(s))},fail(e){console.error(e),t&&t(i,y(e))}})}))}else console.error("[minigamefe GameTransferReport]: 未传入上报函数!!!")}}class We extends Le{constructor({reportFunc:e,logid:t,schemas:n={},base:r,debug:i,namespace:s,asyncGetBase:o=()=>Promise.resolve({}),reportType:a,skipValidateInProdEnv:l=!0}){super({logid:t,schemas:n,base:r,debug:i,namespace:s,skipValidateInProdEnv:l}),this.reportType=Ce.SvrReport,this.reportFunc=e,e||console.error(`[minigamefe${this.namespace}RequestReport]: 未传入上报函数。`),this.asyncGetBase=o,void 0!==a&&(this.reportType=a)}setKvStatBase(e,t){if(this.reportType===Ce.KvStat){var n=(e.system||"").split(" ");Object.assign(this.schemas,{DeviceModel:Re.STRING,DeviceBrand:Re.STRING,OsName:Re.STRING,OsVersion:Re.STRING,LanguageVersion:Re.STRING,Count:Re.UINT,AppId:Re.STRING,AppVersion:Re.UINT,AppState:Re.UINT}),this.setBase({DeviceModel:e.model||"",DeviceBrand:e.brand||"",OsName:n[0]||"",OsVersion:n[1]||"",LanguageVersion:e.language||"",Count:1}),(null==t?void 0:t.miniProgram)&&this.setBase({AppState:qe[t.miniProgram.envVersion]||qe.release,AppId:t.miniProgram.appId,AppVersion:0})}}send(e,t){if(this.reportFunc&&"function"==typeof this.reportFunc){var n,r=[],i=this.logid;n=Array.isArray(e)?e:[e],this.asyncGetBase().then((e=>{this.setBase(e),n.forEach((e=>{var t=Object.assign(Object.assign({},this.base),e);this.validate(t);var n={log_id:i,custom_data:t};r.push(n)}));var s=JSON.stringify({report_list:r});this.debug&&console.log(`[minigamefe${this.namespace}RequestReport]: ${i}`,...r),this.reportFunc({url:"https://game.weixin.qq.com/cgi-bin/comm/datareport",method:"POST",header:{"content-type":"application/x-www-form-urlencoded"},data:s,success(){t&&t(i,JSON.stringify(s))},fail(e){console.error(e),t&&t(i,y(e))}})}))}else console.error("[minigamefe RequestReport]: 未传入上报函数!!!")}}var je=["BenchmarkLevel","NetworkType","RuntimeType","PluginAppId","PluginVersion","Scene","SDKVersion","IsVisible","Type","Target","Params","Result","CostTime","ExternInfo","CustomKey1","CustomKey2","CustomKey3","IsError","FELibVersion","Query"],Ge={BenchmarkLevel:Re.UINT,NetworkType:Re.STRING,RuntimeType:Re.UINT,PluginAppId:Re.STRING,PluginVersion:Re.STRING,Scene:Re.UINT,SDKVersion:Re.STRING,IsVisible:Re.UINT,Type:Re.UINT,Target:Re.STRING,Params:Re.STRING,Result:Re.STRING,CostTime:Re.UINT,ExternInfo:Re.STRING,CustomKey1:Re.STRING,CustomKey2:Re.STRING,CustomKey3:Re.STRING,IsError:Re.UINT,FELibVersion:Re.STRING,Query:Re.STRING};function Ue(e){var t,{type:n=ye.KeyValueReport,reportKeyValue:r,debug:i,gameTransfer:s,systemInfo:o,accountInfo:a,getNetworkType:l,onNetworkStatusChange:c,request:h,namespace:u}=e,d="";function f(){return new Promise((e=>{d?e({NetworkType:d}):l({success:t=>{d=t.networkType,e({NetworkType:d})},fail:()=>{e({NetworkType:d="unknown"})}})}))}return n===ye.KeyValueReport?t=new Me({reportFunc:r,logid:26340,schemas:Ge,protocolParams:je,debug:i,namespace:u,asyncGetBase:f}):n===ye.GameTransferReport?(t=new Oe({reportFunc:s,logid:26340,schemas:Ge,reportType:Ce.KvStat,debug:i,namespace:u,asyncGetBase:f})).setKvStatBase(o,a):(console.warn("[minigamefe]: 当前选择 reqeust 进行质量上报, 请自行确保兼容性"),(t=new We({reportFunc:h,logid:26340,schemas:Ge,debug:i,namespace:u,asyncGetBase:f,reportType:Ce.KvStat})).setKvStatBase(o,a)),n!==ye.GameTransferReport&&n!==ye.WxRequestReport||function(e,t,n){xe?e&&e(xe):(t({success:t=>{xe=t.networkType,e&&e(xe)}}),n((t=>{xe=t.networkType,t.isConnected||(xe="none"),e&&e(xe)})))}((e=>{d=e,t.setBase({NetworkType:e})}),l,c),t}function Ve(e,t){var n,r=e||"";if(n=r,"[object Object]"===Object.prototype.toString.call(n))try{r=JSON.stringify(r)}catch(e){console.error(`[minigamefe stringify error]: ${e}`),r=""}else r=String(r);return r.length&&r.length>=1024&&(r=r.substr(0,1024),console.warn(`[minigamefe stringify warning]: ${t} 上报长度超过1024, 已裁剪`)),r}class Be{constructor(e){var t,r,i;this.benchmarkLevel=0,this.network="",this.runtimeType=Fe.UnKnow,this.sdkVersion="0.0.0",this.isVisible=ge.Front,this.scene=0,this.query="",this.pluginAppId="",this.pluginVersion="",this.inited=!1;var{systemInfo:s,launchInfo:o,onShow:a,onHide:l,pluginAppId:c="",pluginVersion:h=""}=e;if(!a||!l)return console.error("[minigamefe stringify warning]: please inject QualityConfig correctly"),void(this.inited=!1);this.inited=!0,this.onShow=a,this.onHide=l,this.benchmarkLevel=(s.benchmarkLevel||1)+100,this.sdkVersion=s.SDKVersion,this.launchInfo=o,this.scene=(null===(t=this.launchInfo)||void 0===t?void 0:t.scene)||0,v(null===(r=this.launchInfo)||void 0===r?void 0:r.query)||(this.query=encodeURIComponent(JSON.stringify(null===(i=this.launchInfo)||void 0===i?void 0:i.query))),this.runtimeType=function(e){var t,r,i=Fe.UnKnow,s=e.platform.toLocaleLowerCase();return s===Ne.devtools?i=Fe.Devtools:s===Ne.ios?(i=(null===(t=n.g)||void 0===t?void 0:t.isIOSHighPerformanceMode)?Fe.IOSWK:Fe.IOSJscore,e.model.indexOf("iPad")>-1&&(i=(null===(r=n.g)||void 0===r?void 0:r.isIOSHighPerformanceMode)?Fe.IPadWK:Fe.IPadJscore)):s===Ne.android?i=Fe.Android:s===Ne.windows&&(i=Fe.PC),i}(s),this.pluginAppId=c,this.pluginVersion=h,this.bindNativeEvent(),this.reporter=Ue(e),this.reporter.setBase({BenchmarkLevel:this.benchmarkLevel,RuntimeType:this.runtimeType,Scene:+this.scene,SDKVersion:this.sdkVersion,IsVisible:this.isVisible,PluginAppId:c,PluginVersion:h,FELibVersion:"1.1.51",Query:this.query})}bindNativeEvent(){this.onHide((()=>{this.isVisible=ge.Background,this.reporter.setBase({IsVisible:this.isVisible})})),this.onShow((e=>{v(null==e?void 0:e.query)||(this.query=encodeURIComponent(JSON.stringify(e.query))),this.isVisible=ge.Front,this.reporter.setBase({IsVisible:this.isVisible,Query:this.query})}))}innerReport(e){this.reporter.send(Object.assign(e,{CostTime:m(e.CostTime)?e.CostTime:0,Params:Ve(e.Params,"Params"),Result:Ve(e.Result,"Result"),ExternInfo:Ve(e.ExternInfo,"ExternInfo")}))}report(e){Pe.indexOf(e.Type)>-1&&console.error(`[minigamefe quality report]: 若为自定义上报, Type 请不要使用内置枚举值 ${e.Type}, 内置枚举可见 mgp.consts.ReportType`),this.inited&&this.innerReport(e)}setCustomKey(e){this.inited&&this.reporter.setBase({CustomKey1:e.CustomKey1&&Ve(e.CustomKey1,"CustomKey1")||"",CustomKey2:e.CustomKey2&&Ve(e.CustomKey2,"CustomKey2")||"",CustomKey3:e.CustomKey3&&Ve(e.CustomKey3,"CustomKey3")||""})}clearCustomKey(){this.inited&&this.reporter.setBase({CustomKey1:"",CustomKey2:"",CustomKey3:""})}}class Ke{constructor(){this.quality=void 0,this.inited=!1,this.initPromise=void 0,this.initPromise=this.initQuality()}initQuality(){return new Promise((e=>{V.sdk.WXConfig&&V.sdk.WXConfig.onReady((()=>{this.inited=!0,this.quality=new Be({debug:!1,type:ye.KeyValueReport,pluginAppId:"game_audits",pluginVersion:V.sdk.WXConfig.SDKVersion,launchInfo:V.sdk.WXConfig.appLaunchInfo,accountInfo:V.sdk.WXConfig.accountInfo,systemInfo:V.sdk.getSystemInfoSync(),onShow:V.sdk.onShow,onHide:V.sdk.onHide,getNetworkType:V.sdk.getNetworkType,onNetworkStatusChange:V.sdk.onNetworkStatusChange,gameTransfer:V.sdk.gameTransfer,reportKeyValue:V.sdk.reportKeyValue}),e(this.quality)}))}))}report(e){this.inited?this.quality.report(e):this.initPromise.then((()=>{this.quality.report(e)}))}}var $e,He,Je,Xe=null;function Qe(){var e;$e||($e={autoStart:null===(e=V.sdk.WXConfig.audits)||void 0===e?void 0:e.autoStart,enableType:Te.Self,showTimes:V.showTimes,detectTimes:V.detectTimes});return $e}function ze(e){V.isWxApplib&&Xe.report({Type:Ie.Info,Target:be.GetAuthToken,ExternInfo:{errMsg:e,...Qe()}})}var Ye=!1,Ze="";function et(e){e.gameTransfer&&(He=e.gameTransfer,Ye=function(e,t){if("string"!=typeof e||"string"!=typeof t)return"string"!=typeof e&&"string"!=typeof t?0:"string"!=typeof e?1:-1;for(var n=e.split("."),r=t.split("."),i=Math.max(n.length,r.length);n.length<i;)n.push("0");for(;r.length<i;)r.push("0");for(var s=0;s<i;s++){var o=parseInt(n[s],10),a=parseInt(r[s],10);if(o>a)return 1;if(o<a)return-1}return 0}(p().SDKVersion,"2.29.1")>=0),e.authRequest&&(Je=e.authRequest)}function tt(){Ze=""}var nt=-10000401;function rt(){return new Promise(((e,t)=>{var n="unity.refreshcontexttoken",r={auth_payload:{}};if(Ze)return e(Ze);r.auth_payload.expired_time=60;var i={req_path:n,success:n=>{var r,i=n.data;if(U.debug("auth res = ",n,", data=",i),null!=i&&null!==(r=i.rsp_list)&&void 0!==r&&r.length){var s=(i.rsp_list.find((e=>"auth_token"===e.key))||{}).value;if(s)return function({token:e,costTime:t}){V.isWxApplib&&Xe.report({Type:Ie.Info,Target:be.GetAuthToken,ExternInfo:{token:e,costTime:t,...Qe()}})}({token:s,costTime:Se.timeEnd(be.GetAuthToken)}),U.debug("token=",s),Ze=encodeURIComponent(s),e(Ze)}var o="system error";ze(o),t({errMsg:o})},fail:e=>{U.error("gametransfer auth error, ",e),Se.timeEnd(be.GetAuthToken),ze(e.errmsg||"get auth token failed"),t(e)}};Ye?(i.reqData={req_path:n,...r},delete i.req_path):i={...i,...r},He&&(Se.start(be.GetAuthToken),He(i))}))}function it(){return(it=t()((function*(){if(Je){var e=yield Je();return Ze=e,Promise.resolve(Ze)}return Promise.resolve()}))).apply(this,arguments)}function st(){return He?rt():Je?function(){return it.apply(this,arguments)}():void 0}var ot,at,lt="https://game.weixin.qq.com";function ct(e){var t;U.debug(`before ${e.url} request, auth`),null===(t=st())||void 0===t||t.then((t=>{U.debug("request auth token=",t),e.url.includes("ticket")&&(e.url=e.url.substring(0,e.url.indexOf("?ticket"))),e.url=`${e.url}?ticket=${t}`,U.debug("before request, options=",e),ot(e)}))}function ht(e){var t;U.debug(`before ${e.url} upload, auth`),null===(t=st())||void 0===t||t.then((t=>{U.debug("upload auth token=",t),e.url.includes("ticket")&&(e.url=e.url.substring(0,e.url.indexOf("?ticket"))),e.url=`${e.url}?ticket=${t}`,at(e)}))}function ut(e){return t="/cgi-bin/gamewxagbdatawap/addgameevaluationreport",n={meta_info:e},new Promise(((e,r)=>{var i={url:`${lt}${t}`,method:"POST",data:{...n},success:n=>(U.debug(`post ${t} success, res=`,n),200===n.statusCode?n.data.errcode===nt?(tt(),ct(i)):e(n.data):r(n)),fail:e=>{U.error(`post ${t} failed, err=`,e),r(e)}};ct(i)}));var t,n}function dt(e){return t={url:"/cgi-bin/gamewxagbdatawap/uploadfile",filePath:e,name:"file"},new Promise(((e,n)=>{var{url:r,filePath:i,name:s}=t,o={url:`${lt}${r}`,filePath:i,name:s,success(t){if(U.debug(`upload ${r} success, res=`,t),200===t.statusCode){var{data:i}=t;return"string"==typeof i&&(i=JSON.parse(i)),i.errcode===nt?(tt(),ht(o)):e(i)}return n(t)},fail:e=>{U.error(`post ${r} failed, err=`,e),n(e)}};ht(o)}));var t}var ft,pt=function(e){return e[e.iOS=1]="iOS",e[e.Android=2]="Android",e[e.iPad=13]="iPad",e[e.Mac=14]="Mac",e[e.Windows=15]="Windows",e[e.AndroidPad=28]="AndroidPad",e[e.Devtools=-1]="Devtools",e}({}),mt=(pt.iOS,pt.Android,pt.iPad,pt.Mac,pt.Windows,pt.AndroidPad,pt.Devtools,{ios:1,android:2,ipad:13,mac:14,windows:15,devtools:-1}),gt=function(e){return e[e.Launch=0]="Launch",e[e.Performance=1]="Performance",e[e.Practice=2]="Practice",e[e.Render=3]="Render",e[e.Compatibility=4]="Compatibility",e}({}),vt=function(e){return e.Start="start",e.Performance="performance",e.Network="network",e.WxAPI="wxapi",e.Practice="practice",e.Compatibility="compatibility",e.Render="render",e}({}),It=function(e){return e.Init="init",e.Resource="resource",e.Inject="inject",e.Context="context",e.Compile="compile",e}({}),yt=function(e){return e.InitClickStart="clickStart",e.InitContactCGI="contactcgi",e.InitLaunchCGI="launchcgi",e.ResourceApp="resousceApp",e.ResourceSub="resourceSub",e.ResoucePlugin="reesourcePlugin",e.InjectGame="injectGame",e.InjectWxAppLib="injectWxAppLib",e}({}),kt=function(e){return e.longFirstMeaningfulPaint="long-first-meaningful-paint",e.longInteractionCost="long-interaction-cost",e}({}),wt=function(e){return e.highCpuUsage="high-cpu-usage",e.highMemoryUsage="high-memory-usage",e.highAverageFps="high-average-fps",e.highStutter="high-stutter",e}({}),bt=function(e){return e.noIosHighPerformance="no-ios-high-performance",e.noHttp2="no-http2",e.noContentEncoding="no-content-encoding",e.noCdnCache="no-cdn-cache",e.noParallelDownload="no-parallel-download",e.noInteractionReport="no-interaction-report",e.largeNetworkResponse="large-network-response",e.lowNetworkLatencyRation="low-network-latency-ration",e.highNetworkQueueingLatency="high-network-queueing-latency",e.longSingleNetworkLatency="long-single-network",e.highSingleNetworkResponse="high-single-network-response",e.noCacheApiCall="no-cache-api-call",e}({}),Tt=function(e){return e.highDrawcall="high-drawcall",e.noTextureCompression="no-texture-compression",e.incorrectTextureCompressionFormat="incorrect-texture-compression-format",e.unreleasedCanvas="unreleased-canvas",e}({}),St=function(e){return e.noJsError="no-js-error",e.noUnhandledRejection="no-unhandled-rejection",e.noNetworkError="no-network-error",e.noNetworkStatusError="no-network-status-error",e}({}),Rt={[vt.Practice]:{type:vt.Practice,name:"最佳实践检测",description:"",subItems:[]},[vt.Performance]:{type:vt.Performance,name:"运行性能",description:"",subItems:[]},[vt.Start]:{type:vt.Start,name:"启动性能",description:"",subItems:[]},[vt.WxAPI]:{type:vt.WxAPI,name:"wx api",description:"",subItems:[]},[vt.Network]:{type:vt.Network,name:"网络性能",description:"",subItems:[]},[vt.Compatibility]:{type:vt.Compatibility,name:"兼容性",description:"",subItems:[]},[vt.Render]:{type:vt.Render,name:"渲染",description:"",subItems:[]}},Ct={[gt.Launch]:{[kt.longFirstMeaningfulPaint]:{metaInfo:{name:"首帧渲染时长过长",description:"降低小游戏的启动时长对于用户新进留存具有非常重要的价值。",document:[{title:"了解更多",href:"https://developers.weixin.qq.com/minigame/dev/guide/performance/perf-action-start2.html"}],weight:8},headers:[{key:"cost",header:"首屏时间",uint:"ms"}],threshold:5150},[kt.longInteractionCost]:{metaInfo:{name:"游戏可交互时长过长",description:"建议优化游戏启动过程，尽可能减少游戏前置的资源下载，缩短游戏可交互时间，提升用户体验。",document:[{title:"了解更多",href:"https://developers.weixin.qq.com/minigame/dev/guide/performance/perf-action-start-reportScene.html"}],weight:3},headers:[{key:"costTime",header:"可交互耗时",uint:"ms"}],threshold:11840}},[gt.Performance]:{[wt.highCpuUsage]:{metaInfo:{name:"CPU利用率过高",description:"CPU利用率过高较易引起游戏卡顿等问题，建议通过CPU Profile工具排查长耗时逻辑，通过worker等方式优化相关业务逻辑。",document:[{title:"问题排查工具",href:"https://developers.weixin.qq.com/minigame/dev/devtools/profile.html"}],weight:7},headers:[{key:"cpu",header:"平均CPU利用率",uint:"%"}],threshold:30},[wt.highMemoryUsage]:{metaInfo:{name:"内存占用过高",description:"游戏内存占用过高是影响游戏稳定性的最大因素，建议通过相关工具游戏内存问题。",document:[{title:"常见内存优化手段",href:"https://developers.weixin.qq.com/minigame/dev/guide/performance/perf-action-memory-overview.html"}],weight:7},headers:[{key:"memory",header:"平均内存占用",uint:"MB"}],threshold:665600},[wt.highAverageFps]:{metaInfo:{name:"帧率过低",description:"较低的帧率将直接影响游戏体验的流畅度，可通过CPU Profile针对游戏场景排查长耗时任务，定位卡顿原因。",document:[{title:"问题排查工具",href:"https://developers.weixin.qq.com/minigame/dev/devtools/profile.html"}],weight:5},headers:[{key:"fps",header:"平均FPS"}],threshold:50},[wt.highStutter]:{metaInfo:{name:"卡顿率过高",description:"较高的卡顿率将影响游戏用户的实际游玩体验，可考虑适当降低帧率、优化游戏业务逻辑等手段来降低游戏卡顿问题。",document:[],weight:7},headers:[{key:"stutter",header:"卡顿率",uint:"%"}],threshold:1.5}},[gt.Practice]:{[bt.noIosHighPerformance]:{metaInfo:{name:"高性能模式",description:"建议开启高性能模式，iOS设备下能拥有更好的渲染性能和表现。",weight:0,document:[{title:"了解更多",href:"https://developers.weixin.qq.com/minigame/dev/guide/performance/perf-high-performance.html"}]},threshold:!0},[bt.noHttp2]:{metaInfo:{name:"HTTP/2",description:"建议服务器开启HTTP2.0，通过多路复用和头部压缩等的特性，能提升细碎文件的下载效率。",weight:8},headers:[{key:"url",header:"URL"},{key:"protocol",header:"协议"}],threshold:!0},[bt.noContentEncoding]:{metaInfo:{name:"服务器压缩",description:"建议开启服务器压缩，尽可能对传输数据进行压缩，减少网络数据的传输体积。",document:[{title:"了解更多",href:"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Encoding"}],weight:10},headers:[{key:"url",header:"URL"},{key:"contentEncoding",header:"content-encoding"}],threshold:!0},[bt.noCdnCache]:{metaInfo:{name:"CDN缓存",description:"发布新版本时，建议进行CDN预热，避免直接从源站拉取资源。",weight:10},headers:[{key:"url",header:"URL"}],threshold:!0},[bt.noParallelDownload]:{metaInfo:{name:"并行下载",description:"建议开启小游戏分包的并行下载能力，提前下载后续游戏必要的分包资源，减少用户后续等待分包资源下载的时间，缩短用户进入游戏核心玩法的耗时。",document:[{title:"了解更多",href:"https://developers.weixin.qq.com/minigame/dev/guide/performance/perf-action-start-parallel-download.html"}],weight:0},threshold:!0},[bt.noInteractionReport]:{metaInfo:{name:"游戏可交互上报",description:"建议在游戏资源加载完毕时，上报用户的最早可操作游戏画面的时间点，用于统计游戏启动性能表现以及游戏启动留存情况。",document:[{title:"了解更多",href:"https://developers.weixin.qq.com/minigame/dev/guide/performance/perf-action-start-reportScene.html"}],weight:3},threshold:!0},[bt.largeNetworkResponse]:{metaInfo:{name:"网络请求总响应过大",description:"减小网络请求资源量，过大的资源下载会增加用户启动耗时。",weight:5},headers:[{key:"byteLength",header:"总响应大小",uint:"MB"}],threshold:52428800},[bt.lowNetworkLatencyRation]:{metaInfo:{name:"网络利用率",description:"网络利用率过低，未能在CPU密集时段，充分利用网络带宽。",weight:6},headers:[{key:"networkLatencyRation",header:"网络利用率",uint:"%"}],threshold:30},[bt.highNetworkQueueingLatency]:{metaInfo:{name:"网络排队平均耗时",description:"网络排队平均耗时过高，排队超过一定时长会对用户体验造成影响。可以考虑使用CDN加速、使用HTTP/2协议等技术，减少网络请求的延迟时间。",weight:6},headers:[{key:"networkQueueingLatency",header:"平均网络排队耗时",uint:"ms"}],threshold:1500},[bt.longSingleNetworkLatency]:{metaInfo:{name:"单个网络耗时过长",description:"单个网络耗时过长，耗时过长会对用户体验造成影响。可以考虑使用CDN加速、使用HTTP/2协议等技术，减少网络请求的延迟时间。",weight:8},headers:[{key:"url",header:"URL"},{key:"callbackDuration",header:"网络耗时",uint:"ms"}],threshold:1500},[bt.highSingleNetworkResponse]:{metaInfo:{name:"单个网络请求资源量过大",description:"网络请求体积大会导致请求的传输时间变长，影响用户体验。可适当将资源拆分进行按需下载、或使用数据压缩。",weight:8},headers:[{key:"url",header:"URL"},{key:"byteLength",header:"响应大小",uint:"MB"}],threshold:3145728},[bt.noCacheApiCall]:{metaInfo:{name:"wx api调用缓存",description:"建议在调用API时，使用缓存，减少API的重复调用次数，提升用户体验。",weight:5},headers:[{key:"apiName",header:"接口名称"},{key:"times",header:"调用次数"}],threshold:3}},[gt.Render]:{[Tt.highDrawcall]:{metaInfo:{name:"Drawcall过高",description:"建议使用合适手段减少Drawcall调用次数，大量、频繁的绘制请求，会一定程度上降低游戏帧率，造成游戏卡顿等问题",weight:5},headers:[{key:"drawcall",header:"峰值drawcall"}],threshold:200},[Tt.noTextureCompression]:{metaInfo:{name:"未使用纹理压缩",description:"建议针对纹理资源，使用压缩格式，减少纹理大小，提升用户体验。",weight:0},headers:[{key:"asset",header:"资源名"},{key:"format",header:"压缩格式"}],threshold:!0},[Tt.incorrectTextureCompressionFormat]:{metaInfo:{name:"未使用合理的纹理压缩",description:"建议使用合理的压缩格式，减少纹理大小，提升用户体验。",document:[{title:"常见纹理压缩格式兼容性",href:"https://developers.weixin.qq.com/minigame/dev/guide/performance/perf-technical-manual.html"}],weight:0},headers:[{key:"asset",header:"资源名"},{key:"format",header:"压缩格式"}]},[Tt.unreleasedCanvas]:{metaInfo:{name:"未释放Canvas",description:"建议主动释放Canvas实例，减少内存占用，特别是在iOS设备下，过高的内存占用较为容易造成内存不足而导致小游戏被kill的问题。",weight:0},headers:[{key:"count",header:"未释放canvas数"}]}},[gt.Compatibility]:{[St.noJsError]:{metaInfo:{name:"存在JavaScript Exception",description:"出现 JavaScript 异常可能导致程序的交互无法进行下去，我们应当追求零异常，保证程序的高鲁棒性和高可用性",weight:9},headers:[{key:"message",header:"错误信息"},{key:"stack",header:"错误堆栈"}]},[St.noUnhandledRejection]:{metaInfo:{name:"存在Unhandled Promise Rejection",description:"处理 Unhandled Promise Rejection，我们可以使程序更稳定。",weight:9},headers:[{key:"reason",header:"错误信息"}]},[St.noNetworkError]:{metaInfo:{name:"存在网络错误",description:"处理网络错误有助于提高用户体验",weight:10},headers:[{key:"url",header:"URL"},{key:"errMsg",header:"错误信息"}]},[St.noNetworkStatusError]:{metaInfo:{name:"存在网络状态码错误",description:"处理网络错误有助于提高用户体验",weight:10},headers:[{key:"url",header:"URL"},{key:"statusCode",header:"状态码"}]}}};ft={},Object.keys(Ct).forEach((e=>{ft={...ft,...Ct[e]}})),vt.Start,vt.Performance,vt.Render,vt.Practice,vt.Compatibility;class Pt extends i{constructor(...e){super(...e),this.invokeList=[],this.recordApi=e=>{this.invokeList.push(e.invokeInfo)}}init(){P.on(q.Invoked,this.recordApi)}off(){P.off(q.Invoked,this.recordApi)}getResult(){return{invokeList:this.invokeList}}reset(){this.invokeList=[]}}class _t extends i{constructor(...e){super(...e),this.fmp={},this.recordFMP=()=>{}}init(){}off(){}getResult(){return this.fmp={[It.Init]:[{stageName:yt.InitClickStart,stageType:It.Init,startTime:0,endTime:0,delta:0}],[It.Resource]:[{stageName:yt.ResourceApp,stageType:It.Resource,startTime:0,endTime:0,delta:0,size:0,resourceName:"app"}],[It.Inject]:[{stageName:yt.InjectGame,stageType:It.Inject,startTime:0,endTime:0,delta:0,resouceName:"app",evaluateStartTime:0}],[It.Context]:[{stageType:It.Context,startTime:0,endTime:0,delta:0,contextId:0,contextName:"main"}],[It.Compile]:[{stageType:It.Compile,startTime:0,endTime:0,delta:0}]},this.fmp}reset(){this.fmp=null}}class Lt extends i{constructor(...e){super(...e),this.networkList=[],this.recordNetwork=e=>{var{generalNetworkInfo:t}=e;if(t){var{networkInfo:n,invokeInfoMap:r}=t,i=r.get(t);if(i){var{invokeInfo:s}=i;this.networkList.push(Object.assign({},n,s))}}}}init(){P.on(_.LoadSuccess,this.recordNetwork),P.on(_.LoadFail,this.recordNetwork)}off(){P.off(_.LoadSuccess,this.recordNetwork),P.off(_.LoadFail,this.recordNetwork)}getResult(){return{networkList:this.networkList}}reset(){this.networkList=[]}}class xt extends i{constructor(...e){super(...e),this.performanceList=[],this.recordPerformance=e=>{this.performanceList.push(e.performanceInfo)}}init(){P.on(E,this.recordPerformance)}off(){P.off(E,this.recordPerformance)}getResult(){return{performanceList:this.performanceList}}reset(){this.performanceList=[]}}class Nt extends i{constructor(...e){super(...e),this.metaInfo=void 0,this.failedItems=[],this.ruleId=void 0,this.threshold=void 0,this.headers=void 0,this.enable=!1}addFailedItem(e){e&&this.failedItems.push(e)}addFailedItems(e){e.forEach((e=>{this.addFailedItem(e)}))}generateResult(){var e=Object.assign(Object.create(null),{ruleId:this.ruleId,failedItems:this.failedItems});return this.headers&&(e.headers=this.headers),this.metaInfo&&Object.assign(e,this.metaInfo),e}clear(){this.failedItems=[]}init(){}}class Et extends Nt{constructor(...e){super(...e),this.ruleId=bt.noCdnCache,this.threshold=Ct[gt.Practice][this.ruleId].threshold,this.handler=e=>{var t;this.check(e)||(U.warn(`check ${this.ruleId} failed current=`,null===(t=e.generalNetworkInfo)||void 0===t?void 0:t.networkInfo.url),this.addFailedItem(this.generateItem(e)))}}init(){P.on(_.LoadSuccess,this.handler)}off(){P.off(_.LoadSuccess,this.handler)}check(e){var{generalNetworkInfo:t}=e;return!t||t.networkInfo.cache===this.threshold}generateItem(e){var t,{generalNetworkInfo:n}=e;return n?{uniqueId:null===(t=n.invokeInfoMap.get(n))||void 0===t?void 0:t.invokeInfo.uniqueId}:null}}class At extends Nt{constructor(...e){super(...e),this.ruleId=bt.noContentEncoding,this.threshold=Ct[gt.Practice][this.ruleId].threshold,this.handler=e=>{var t;this.check(e)||(U.warn(`check ${this.ruleId} failed, current=`,null===(t=e.generalNetworkInfo)||void 0===t?void 0:t.networkInfo.url),this.addFailedItem(this.generateItem(e)))}}init(){P.on(_.LoadSuccess,this.handler)}off(){P.off(_.LoadSuccess,this.handler)}check(e){var{generalNetworkInfo:t}=e,n=!0;if(!t)return n;var r=t.result,{contentEncoding:i}=t.networkInfo;return W(r.statusCode)&&i&&(n=i.includes("gzip")||i.includes("br")),n===this.threshold}generateItem(e){var t,{generalNetworkInfo:n}=e;return n?{uniqueId:null===(t=n.invokeInfoMap.get(n))||void 0===t?void 0:t.invokeInfo.uniqueId}:null}}class qt extends Nt{constructor(...e){super(...e),this.ruleId=bt.noHttp2,this.threshold=Ct[gt.Practice][this.ruleId].threshold,this.handler=e=>{var t;this.check(e)||(U.warn(`check ${this.ruleId} failed, current=`,null===(t=e.generalNetworkInfo)||void 0===t?void 0:t.networkInfo.url,e.args),this.addFailedItem(this.generateItem(e)))}}init(){P.on(_.LoadSuccess,this.handler)}off(){P.off(_.LoadSuccess,this.handler)}check(e){var{generalNetworkInfo:t}=e,n=!0;if(!t)return n;var r,i,s=t.result,{networkInfo:o}=t;W(s.statusCode)&&o.protocol&&(n="h2"===o.protocol||(null===(r=o.protocol)||void 0===r||null===(i=r.includes)||void 0===i?void 0:i.call(r,"http/2")));return n===this.threshold}generateItem(e){var t,{generalNetworkInfo:n}=e;return n?{uniqueId:null===(t=n.invokeInfoMap.get(n))||void 0===t?void 0:t.invokeInfo.uniqueId}:null}}class Ft extends Nt{constructor(...e){super(...e),this.ruleId=bt.highNetworkQueueingLatency,this.threshold=Ct[gt.Practice][this.ruleId].threshold,this.averageQueueTime=0,this.handler=()=>{this.check()||(U.warn(`check ${bt.highNetworkQueueingLatency} failed, current=`,this.averageQueueTime,", threshold=",this.threshold),this.addFailedItem(this.generateItem()))}}init(){P.on(N,this.handler)}off(){P.off(N,this.handler)}check(){var{totalQueueCount:e,totalQueueTime:t}=K.networkInfo;return e&&(this.averageQueueTime=t/e),this.averageQueueTime<this.threshold}generateItem(){return{networkQueueingLatency:this.averageQueueTime}}}class Dt extends Nt{constructor(...e){super(...e),this.ruleId=bt.highSingleNetworkResponse,this.threshold=Ct[gt.Practice][this.ruleId].threshold,this.handler=e=>{var t;this.check(e)||(U.warn(`check ${this.ruleId} failed, current=`,null===(t=e.generalNetworkInfo)||void 0===t?void 0:t.networkInfo.byteLength,", threshold=",this.threshold),this.addFailedItem(this.generateItem(e)))}}init(){P.on(_.LoadSuccess,this.handler)}off(){P.off(_.LoadSuccess,this.handler)}check(e){var{generalNetworkInfo:t}=e,n=!0;if(!t)return n;var r=t.result,{byteLength:i}=t.networkInfo;return W(r.statusCode)&&i&&(n=i<this.threshold),n}generateItem(e){var t,{generalNetworkInfo:n}=e;return n?{uniqueId:null===(t=n.invokeInfoMap.get(n))||void 0===t?void 0:t.invokeInfo.uniqueId}:null}}class Mt extends Nt{constructor(...e){super(...e),this.ruleId=bt.largeNetworkResponse,this.threshold=Ct[gt.Practice][this.ruleId].threshold,this.handler=()=>{this.check()||(U.warn("check large-network-response failed, current=",K.networkInfo.responseSize,", threshold=",this.threshold),this.addFailedItem(this.generateItem()))}}init(){P.on(N,this.handler)}off(){P.off(N,this.handler)}check(){return K.networkInfo.responseSize<this.threshold}generateItem(){return{byteLength:K.networkInfo.responseSize}}}class Ot extends Nt{constructor(...e){super(...e),this.ruleId=bt.longSingleNetworkLatency,this.threshold=Ct[gt.Practice][this.ruleId].threshold,this.handler=e=>{if(!this.check(e)){var{generalNetworkInfo:t}=e,n=null==t?void 0:t.invokeInfoMap.get(t);U.warn(`check ${bt.longSingleNetworkLatency} failed, current=`,null==n?void 0:n.invokeInfo.callbackDuration,", threshold=",this.threshold),this.addFailedItem(this.generateItem(e))}}}init(){P.on(_.LoadSuccess,this.handler)}off(){P.off(_.LoadSuccess,this.handler)}check(e){var{generalNetworkInfo:t}=e,n=!0;if(!t)return n;var r=t.result,i=t.invokeInfoMap.get(t);if(i){var{invokeInfo:{callbackDuration:s}}=i;W(r.statusCode)&&s&&(n=s<this.threshold)}return n}generateItem(e){var t,{generalNetworkInfo:n}=e;return n?{uniqueId:null===(t=n.invokeInfoMap.get(n))||void 0===t?void 0:t.invokeInfo.uniqueId}:null}}class Wt extends Nt{constructor(...e){super(...e),this.ruleId=bt.noInteractionReport,this.threshold=Ct[gt.Practice][this.ruleId].threshold,this.reported=!1,this.handler=()=>{this.check()||(U.warn(`check ${this.ruleId} failed, current=`,this.reported),this.addFailedItem(this.generateItem()))},this.reportInteractionHandler=()=>{this.reported=!0}}init(){P.on(N,this.handler),P.on(q.ReportInteraction,this.reportInteractionHandler)}off(){P.off(N,this.handler),P.off(q.ReportInteraction,this.reportInteractionHandler)}generateItem(){return{passed:!1}}check(){return this.reported===this.threshold}clear(){super.clear(),this.reported=!1}}class jt extends Nt{constructor(...e){super(...e),this.ruleId=bt.noIosHighPerformance,this.iosHighPerformance=!0,this.threshold=Ct[gt.Practice][this.ruleId].threshold,this.handler=()=>{this.check()||(U.warn(`check ${this.ruleId} failed, current=`,this.iosHighPerformance),this.addFailedItem(this.generateItem()))}}init(){P.on(L,this.handler)}off(){P.off(L,this.handler)}generateItem(){return{passed:!1}}check(){return this.iosHighPerformance=V.iOSHighPerformance,this.iosHighPerformance===this.threshold}}class Gt extends Nt{constructor(...e){super(...e),this.ruleId=bt.noParallelDownload,this.parallelDownload=!0,this.threshold=Ct[gt.Practice][this.ruleId].threshold,this.handler=()=>{this.check()||(U.warn(`check ${this.ruleId} failed, current=`,this.parallelDownload),this.addFailedItem(this.generateItem()))}}init(){P.on(L,this.handler)}off(){P.off(L,this.handler)}generateItem(){return{passed:!1}}check(){var e,t;return(null===(e=V.subpackages)||void 0===e?void 0:e.length)&&(null===(t=V.parallelPreloadSubpackages)||void 0===t?void 0:t.length)}}class Ut extends Nt{constructor(...e){super(...e),this.ruleId=kt.longInteractionCost,this.threshold=Ct[gt.Launch][this.ruleId].threshold,this.handler=e=>{this.check(e)||(U.warn(`check ${this.ruleId} failed, current=`,e.costTime,", threshold=",this.threshold),this.addFailedItem(this.generateItem(e)))}}init(){P.on(q.ReportInteraction,this.handler)}off(){P.off(q.ReportInteraction,this.handler)}check(e){var{costTime:t,sceneId:n}=e;return!n||7!==n||!t||t<this.threshold}generateItem(e){return e}}class Vt extends Nt{constructor(...e){super(...e),this.ruleId=wt.highAverageFps,this.threshold=Ct[gt.Performance][this.ruleId].threshold,this.handler=e=>{this.check(e)||(U.warn(`check ${this.ruleId} failed, current=`,e.performanceInfo.fps,", threshold=",this.threshold),this.addFailedItem(this.generateItem(e)))}}init(){P.on(E,this.handler)}off(){P.off(E,this.handler)}check(e){var{performanceInfo:t}=e;return t.fps>this.threshold}generateItem(e){return{fps:e.performanceInfo.fps,uniqueId:e.performanceInfo.uniqueId}}}class Bt extends Nt{constructor(...e){super(...e),this.ruleId=wt.highCpuUsage,this.threshold=Ct[gt.Performance][this.ruleId].threshold,this.handler=e=>{this.check(e)||(U.warn(`check ${this.ruleId} failed, current=`,e.performanceInfo.cpu,", threshold=",this.threshold),this.addFailedItem(this.generateItem(e)))}}init(){P.on(E,this.handler)}off(){P.off(E,this.handler)}check(e){var{performanceInfo:t}=e;return t.cpu<this.threshold}generateItem(e){return{cpu:e.performanceInfo.cpu,uniqueId:e.performanceInfo.uniqueId}}}class Kt extends Nt{constructor(...e){super(...e),this.ruleId=wt.highMemoryUsage,this.threshold=Ct[gt.Performance][this.ruleId].threshold,this.handler=e=>{this.check(e)||(U.warn(`check ${this.ruleId} failed, current=`,e.performanceInfo.memory,", threshold=",this.threshold),this.addFailedItem(this.generateItem(e)))}}init(){P.on(E,this.handler)}off(){P.off(E,this.handler)}check(e){var{performanceInfo:t}=e;return t.memory<this.threshold}generateItem(e){return{memory:e.performanceInfo.memory,uniqueId:e.performanceInfo.uniqueId}}}class $t extends Nt{constructor(...e){super(...e),this.ruleId=wt.highStutter,this.threshold=Ct[gt.Performance][this.ruleId].threshold,this.handler=e=>{this.check(e)||(U.warn(`check ${this.ruleId} failed, current=`,e.performanceInfo.stutter,", threshold=",this.threshold),this.addFailedItem(this.generateItem(e)))}}init(){P.on(E,this.handler)}off(){P.off(E,this.handler)}check(e){var{performanceInfo:t}=e;return t.stutter<this.threshold}generateItem(e){return{stutter:e.performanceInfo.stutter,uniqueId:e.performanceInfo.uniqueId}}}class Ht extends Nt{constructor(...e){super(...e),this.ruleId=Tt.highDrawcall,this.drawcall=0,this.latestFrame=0,this.threshold=Ct[gt.Render][this.ruleId].threshold,this.handler=()=>{this.drawcall+=1,this.latestFrame||(this.latestFrame=k.currentFrame),k.currentFrame!==this.latestFrame&&(this.check()||this.addFailedItem(this.generateItem()),this.latestFrame=0,this.drawcall=0)}}init(){P.on(A,this.handler)}off(){P.off(A,this.handler)}check(){return this.drawcall<this.threshold}generateItem(){return{drawcall:this.drawcall}}}class Jt extends Nt{constructor(...e){super(...e),this.ruleId=St.noJsError,this.threshold=Ct[gt.Compatibility][this.ruleId].threshold,this.handler=e=>{U.warn(`check ${this.ruleId} failed, current=`,e.message),this.addFailedItem(this.generateItem(e))}}init(){P.on(q.JsError,this.handler)}off(){P.off(q.JsError,this.handler)}generateItem(e){return{message:String.prototype.slice.call(e.message,0,1024),stack:String.prototype.slice.call(e.stack,0,1024),frame:k.currentFrame,runtime:k.getRuntime()}}}class Xt extends Nt{constructor(...e){super(...e),this.ruleId=St.noUnhandledRejection,this.threshold=Ct[gt.Compatibility][this.ruleId].threshold,this.handler=e=>{U.warn(`check ${this.ruleId} failed, current=`,e.reason),this.addFailedItem(this.generateItem(e))}}init(){P.on(q.UnhandledPromiseRejection,this.handler)}off(){P.off(q.UnhandledPromiseRejection,this.handler)}generateItem(e){return{reason:String.prototype.slice.call(e.reason,0,1024),frame:k.currentFrame,runtime:k.getRuntime()}}}class Qt extends Nt{constructor(...e){super(...e),this.ruleId=St.noNetworkError,this.threshold=Ct[gt.Compatibility][this.ruleId].threshold,this.handler=e=>{U.warn(`check ${this.ruleId} failed, info=`,e),this.addFailedItem(this.generateItem(e))}}init(){P.on(_.LoadFail,this.handler)}off(){P.off(_.LoadFail,this.handler)}generateItem(e){var{generalNetworkInfo:t}=e;if(t){var n,r=null===(n=t.invokeInfoMap.get(t))||void 0===n?void 0:n.invokeInfo;return{uniqueId:null==r?void 0:r.uniqueId}}return null}}class zt extends Nt{constructor(...e){super(...e),this.ruleId=St.noNetworkStatusError,this.threshold=Ct[gt.Compatibility][this.ruleId].threshold,this.handler=e=>{this.check(e)||(U.warn(`check ${this.ruleId} failed, info=`,e),this.addFailedItem(this.generateItem(e)))}}init(){P.on(_.LoadSuccess,this.handler)}off(){P.off(_.LoadSuccess,this.handler)}check(e){var{generalNetworkInfo:t}=e,n=!0;return t?(W(t.result.statusCode)||(n=!1),n):n}generateItem(e){var{generalNetworkInfo:t}=e;if(t){var n,r=null===(n=t.invokeInfoMap.get(t))||void 0===n?void 0:n.invokeInfo;return{uniqueId:null==r?void 0:r.uniqueId}}return null}}class Yt extends i{constructor(...e){super(...e),this.deviceInfo=void 0,this.result=void 0,this.resultFilename="__detect_result.txt"}reset(){this.result=null}getDeviceInfo(){var e=this;return t()((function*(){var t=f(),n=p();if(!e.deviceInfo&&t&&n){var r=yield e.getNetworkType();e.deviceInfo={platform:mt[t.platform],wechatVersion:n.version,deviceBrand:t.brand,deviceModel:e.convertDeviceModel(t.model),SDKVersion:n.SDKVersion,osName:t.system,osVersion:t.system,memorySize:t.memorySize,benchmarkLevel:t.benchmarkLevel,networkType:r}}return e.deviceInfo}))()}uploadReport(){var e=this;return t()((function*(){return e.addEveluationReport(e.getResult())}))()}getNetworkType(){return new Promise(((e,t)=>{d().getNetworkType({success(t){e(t.networkType)},fail:t})}))}addEveluationReport(e){var n=this;return t()((function*(){var t,r,[,i]=yield g(n.storeResult(e));if(i){Se.start(be.UploadReport);var[s,o]=yield g(n.uploadEveluationReport(i));if(s)return Se.timeEnd(be.UploadReport),function({errMsg:e}){V.isWxApplib&&Xe.report({Type:Ie.Info,Target:be.UploadReport,ExternInfo:{errMsg:e,...Qe()}})}((null==s?void 0:s.errMsg)||(null==s?void 0:s.statusCode)||s),U.error("upload error, ",s),Zt.getInstance().showUploadFailed(s,!0),Promise.reject(s);if(o){var a;U.event("upload success, ",o),function({costTime:e,blobid:t}){V.isWxApplib&&Xe.report({Type:Ie.Info,Target:be.UploadReport,ExternInfo:{costTime:e,blobid:t,...Qe()}})}({blobid:o,costTime:Se.timeEnd(be.UploadReport)}),Se.start(be.AddEveluationReport);var[l,c]=yield g(ut({device:n.convertDeviceInfo(e.device),start_time:V.meta.startTime,blob_id:o,end_time:V.meta.endTime,official_desc:(null==V||null===(a=V.audits)||void 0===a?void 0:a.systemDescription)||""}));return c&&0===c.errcode?(r=Se.timeEnd(be.AddEveluationReport),V.isWxApplib&&Xe.report({Type:Ie.Info,Target:be.AddEveluationReport,ExternInfo:{costTime:r,...Qe()}}),U.debug("addGameEveluationReport success, ",c),U.event("addGameEveluationReport success"),Zt.getInstance().showUploadSuccess(),n.removeResult(),Promise.resolve()):(t=(null==l?void 0:l.errMsg)||(null==c?void 0:c.errcode),V.isWxApplib&&Xe.report({Type:Ie.Info,Target:be.AddEveluationReport,ExternInfo:{errMsg:t,...Qe()}}),U.error("addEveluation error, ",l||c),Zt.getInstance().showUploadFailed(l||c),Promise.reject(l||c))}}}))()}uploadEveluationReport(e){return dt(e).then((e=>e.data&&e.data.file_meta_list?Promise.resolve(e.data.file_meta_list[0].blob_id):Promise.reject(e.errcode)))}storeResult(e){return new Promise(((t,n)=>{var{wxapi:r,network:i,performance:o,checkLists:a,fmp:l}=e,c=0;try{Se.start("stringifyResult"),c=JSON.stringify(e).length,U.debug("report fileSize=",c,", cost=",Se.timeEnd("stringifyResult"))}catch(e){U.error("calculate report fileSize error, ",e)}var h=`${d().env.USER_DATA_PATH}/${this.resultFilename}`;Se.start(be.WriteReport),s({filePath:h,data:JSON.stringify({wxapi:r,network:i,performance:o,checkLists:a,fmp:l}),success:()=>{!function({fileSize:e,costTime:t}){V.isWxApplib&&Xe.report({Type:Ie.Info,Target:be.WriteReport,ExternInfo:{fileSize:e,costTime:t,...Qe()}})}({fileSize:c,costTime:Se.timeEnd(be.WriteReport)}),t(h)},fail:e=>{!function({fileSize:e,errMsg:t}){V.isWxApplib&&Xe.report({Type:Ie.Info,Target:be.WriteReport,ExternInfo:{fileSize:e,errMsg:t,...Qe()}})}({fileSize:c,errMsg:e.errMsg}),n(e)}})}))}removeResult(){return new Promise(((e,t)=>{var n=`${d().env.USER_DATA_PATH}/${this.resultFilename}`;Se.start(be.RemoveReportFile),o({filePath:n,success:t=>{var n;n=Se.timeEnd(be.RemoveReportFile),V.isWxApplib&&Xe.report({Type:Ie.Info,Target:be.RemoveReportFile,ExternInfo:{costTime:n,...Qe()}}),e(t)},fail:e=>{var n;n=e.errMsg,V.isWxApplib&&Xe.report({Type:Ie.Info,Target:be.RemoveReportFile,ExternInfo:{errMsg:n,...Qe()}}),t(e)}})}))}getResult(){if(!this.result){var e=Pt.getInstance().getResult(),t=Lt.getInstance().getResult(),n=xt.getInstance().getResult(),r=_t.getInstance().getResult(),i=function(){var e=Rt[vt.Practice];return e.subItems=[Et.getInstance().generateResult(),At.getInstance().generateResult(),qt.getInstance().generateResult(),Ft.getInstance().generateResult(),Dt.getInstance().generateResult(),Mt.getInstance().generateResult(),Ot.getInstance().generateResult(),Wt.getInstance().generateResult(),jt.getInstance().generateResult(),Gt.getInstance().generateResult()],e}(),s=function(){var e=Rt[vt.Start];return e.subItems=[Ut.getInstance().generateResult()],e}(),o=function(){var e=Rt[vt.Performance];return e.subItems=[Vt.getInstance().generateResult(),Bt.getInstance().generateResult(),Kt.getInstance().generateResult(),$t.getInstance().generateResult()],e}(),a=function(){var e=Rt[vt.Render];return e.subItems=[Ht.getInstance().generateResult()],e}(),l=function(){var e=Rt[vt.Compatibility];return e.subItems=[Jt.getInstance().generateResult(),Xt.getInstance().generateResult(),Qt.getInstance().generateResult(),zt.getInstance().generateResult()],e}();V.meta.uploadTime=Date.now(),this.result={meta:V.meta,device:this.deviceInfo,wxapi:e,network:t,performance:n,checkLists:[i,s,o,a,l],fmp:r}}return U.debug("result=",this.result),this.result}convertDeviceInfo(e){if(!e)return{};var{platform:t,wechatVersion:n,deviceBrand:r,deviceModel:i,SDKVersion:s,osName:o,osVersion:a,benchmarkLevel:l,memorySize:c,networkType:h}=e;return{platform:t,wechat_version:n,device_brand:r,device_model:i,sdk_version:s,os_name:o,os_version:a,benchmark_level:l,memory_size:c,network_type:h}}convertDeviceModel(e){if(null!=e&&e.includes("unknown")&&"ios"===V.sdk.WXConfig.platform){if(e.includes("<iPhone15,4>"))return"iPhone 15";if(e.includes("<iPhone15,5>"))return"iPhone 15 Plus";if(e.includes("<iPhone16,1>"))return"iPhone 15 Pro";if(e.includes("<iPhone16,2>"))return"iPhone 15 Pro Max"}return e}}class Zt extends i{constructor(...e){super(...e),this.coverview=void 0,this.ui=void 0,this.inited=!1,this.draged=!1,this.screenWidth=0,this.screenHeight=0,this.defaultWidth=76,this.defaultHeight=ke,this.defaultTop=60,this.defaultTopPortrait=200,this.defaultLeft=0,this.deviceOrientation="portrait"}init(e){this.inited||(this.inited=!0,e&&(this.coverview=e,setTimeout((()=>{this.create()}),1e3)))}create(){if(this.coverview){var{Component:e,getPrivateThis:t,init:n,webviewLayout:r,xmlParser:i}=this.coverview;this.ui=new e;var s=t(this.ui),o=i('\n  <view id="body">\n    <view id="container">\n      <image id="stop-icon" src="https://mmgame.qpic.cn/image/b5afaa12383dfdd20314efea098fc902f29b33df99010626b01f676f3765d82c/0"></image>\n      <image id="start-icon" src="https://mmgame.qpic.cn/image/171782a3ed34a9322ef8ceed3916b13a293475191ca0745dbb6a3988bc634bf8/0"></image>\n      <text id="operate-btn" value="开始录制"></text>\n    </view>\n    <view id="touch-mask"></view>\n  </view>\n').root,a=JSON.parse(JSON.stringify(we)),l=M(o,"operate-btn"),c=d().getSystemInfoSync();this.setDeviceOrientation(c),un.autoStart?(l.attributes.value="录制中...",a.operateBtn.color="#ff6146",a.startIcon.hidden=!0,a.stopIcon.hidden=!1):(l.attributes.value="开始录制",a.operateBtn.color="#ffffff",a.stopIcon.hidden=!0,a.startIcon.hidden=!1),this.setOperateBtnPos(a,c),n.call(this.ui,o,a),r.add(s.body),this.bindClick(s)}}setOperateBtnPos(e,t){var{deviceOrientation:n}=this,r="landscape"===n||"landscapeLeft"===n?t.safeArea.left||t.safeArea.top:0;"portrait"!==n&&"landscapeRight"!==n||(e.body.top=this.defaultTopPortrait,e.body.left=this.defaultLeft),"landscape"!==n&&"landscapeLeft"!==n||(e.body.top=this.defaultTop,e.body.left=this.defaultLeft+r)}setDeviceOrientation(e){var t=e.deviceOrientation,n=e.windowWidth,r=e.windowHeight;return"portrait"===t&&n>r?n>r&&(t="landscape",n=e.windowHeight,r=e.windowWidth):n<r&&(t="portrait",n=e.windowHeight,r=e.windowWidth),this.deviceOrientation=t,this.screenWidth=n,this.screenHeight=r,this.deviceOrientation}bindDragEvent(e){e.touchMask.on("touchstart",(t=>{this.beforeDrag(e);var n=t.x-e.container.style.left,r=t.y-e.container.style.top,i=t=>{this.draged=!0;var i=t[0].x-n,s=t[0].y-r,o=this.screenWidth-this.defaultWidth,a=this.screenHeight-this.defaultHeight;e.container.style.left=Math.max(0,Math.min(i,o)),e.container.style.top=Math.max(0,Math.min(s,a))},s=()=>{e.touchMask.off("touchmove",i),e.touchMask.off("touchend",s),this.draged||(un.isRunning?this.showConfirm():this.setRunning()),this.draged=!1,this.afterDrag(e)};e.touchMask.on("touchmove",i),e.touchMask.on("touchend",s)}))}bindClick(e){me(e.touchMask,(()=>{un.isRunning?this.showConfirm():this.setRunning()}))}beforeDrag(e){e.container.style.opacity=0,e.body.style.width=this.screenWidth,e.body.style.height=this.screenHeight,e.container.style.left=e.body.style.left,e.container.style.top=e.body.style.top,e.touchMask.style.left=e.body.style.left,e.touchMask.style.top=e.body.style.top,e.body.style.top=0,e.body.style.left=0,e.container.style.opacity=1}afterDrag(e){e.container.style.hidden=!0,e.body.style.left=e.container.style.left,e.body.style.top=e.container.style.top,e.body.style.height=this.defaultHeight,e.body.style.width=this.defaultWidth,e.container.style.left=0,e.container.style.top=0,e.touchMask.style.left=0,e.touchMask.style.top=0,e.container.style.hidden=!1}setRunning(){if(un.start(),this.coverview){var{getPrivateThis:e}=this.coverview,t=e(this.ui);t.operateBtn.value="录制中...",t.operateBtn.style.color="#ff6146",t.startIcon.style.hidden=!0,t.stopIcon.style.hidden=!1}}setStop(){if(this.coverview){var{getPrivateThis:e}=this.coverview,t=e(this.ui);t.operateBtn.value="开始录制",t.operateBtn.style.color="#ffffff",t.stopIcon.style.hidden=!0,t.startIcon.style.hidden=!1}d().showLoading({title:"上传中..."}),un.stop()}showConfirm(){d().showModal({title:"是否结束录制并上传本次评测数据？",content:"将会根据上传数据分析得出录制期间的性能报告",confirmText:"上传数据",success:e=>{e.confirm&&this.setStop()}})}showUploadSuccess(){d().hideLoading(),d().showModal({title:"数据上传成功",content:"请前往性能结果页面，查看详细性能测评报告",showCancel:!1,confirmText:"我知道了"})}showUploadFailed(e,t=!1){d().hideLoading();var n=e;if(!("number"==typeof e)){var{statusCode:r}=e,{errcode:i}=e;n=r||i||e.errno}d().showModal({title:t?"报告上传失败":"报告添加失败",content:`错误代码: ${n}`,confirmText:"重试",success(e){e.confirm&&Yt.getInstance().uploadReport().then(un.reset)}})}}function en(){var e=d(),t=Object.keys(e),n=[$.Request,$.DownloadFile,$.CreateImage,$.CreateCanvas,$.OnError,$.OnUnhandledRejection],r=[...[H.Env,H.Cloud],...n];t.forEach((t=>{if(!r.includes(t)){var n=e[t];Reflect.defineProperty(e,t,{value:(...e)=>Q(t,n,void 0,...e)})}})),function(){var e=d();Reflect.defineProperty(e,"startMinigameDetect",{value(){Zt.getInstance().setRunning()},configurable:!0}),Reflect.defineProperty(e,"stopMinigameDetect",{value(){Zt.getInstance().setStop()},configurable:!0})}()}var tn=!1;function nn(){var e,t,n,r,i,s;if(!tn){tn=!0;var o=null===(e=V.audits)||void 0===e||null===(t=e.rules)||void 0===t?void 0:t.disableRequest,a=null===(n=V.audits)||void 0===n||null===(r=n.rules)||void 0===r?void 0:r.disableCreateImage,l=null===(i=V.audits)||void 0===i||null===(s=i.rules)||void 0===s?void 0:s.disableDownloadFile;!I(o)&&o||function(){var e=$.Request,t=d(),n=t.request;Object.defineProperties(t,{[e]:{value:t=>Q(e,n,{beforeExecute:n=>{K.loadStart(n);var r=new J({generalInvokeInfo:n,apiName:e,args:t,type:$.Request});z.set(n,r),U.debug(t.url,` before ${e} execute, invokeInfo=`,n,", networkInfo=",r.networkInfo),P.emit(_.LoadStart,{args:t,generalNetworkInfo:r})},success:e=>{U.debug(t.url," request success, result=",e.result);var n=z.get(e);n&&(n.complete(),K.loadSuccess(n)),P.emit(_.LoadSuccess,{args:t,generalNetworkInfo:n})},complete:e=>{U.debug(t.url," request complete");var n=z.get(e);P.emit(_.LoadComplete,{args:t,generalNetworkInfo:n})},fail:e=>{U.error(t.url," request fail, result=",e.result,", msg=",e.invokeInfo.errMsg);var n=z.get(e);n&&(n.complete(),K.loadFail(n)),P.emit(_.LoadFail,{args:t,generalNetworkInfo:n})}},t),configurable:!0}})}(),!I(a)&&a||de(),!I(l)&&l||function(){var e=d(),t=$.DownloadFile,n=e.downloadFile;Object.defineProperties(e,{[t]:{value:e=>Q(t,n,{beforeExecute:n=>{K.loadStart(n);var r=new J({generalInvokeInfo:n,apiName:t,args:e,type:$.DownloadFile});Y.set(n,r),U.debug(e.url," before download execute, invokeInfo=",n,", networkInfo=",r.networkInfo),P.emit(_.LoadStart,{args:e,generalNetworkInfo:r})},success:t=>{U.debug(e.url," downloadFile success, result=",t.result);var n=Y.get(t);n&&(n.complete(),K.loadSuccess(n)),P.emit(_.LoadSuccess,{args:e,generalNetworkInfo:n})},complete:t=>{U.debug(e.url," download complete");var n=Y.get(t);P.emit(_.LoadComplete,{args:e,generalNetworkInfo:n})},fail:t=>{U.error(e.url," download fail, result=",t.result,", msg=",t.invokeInfo.errMsg);var n=Y.get(t);n&&(n.complete(),K.loadFail(n)),P.emit(_.LoadFail,{args:e,generalNetworkInfo:n})},afterExecute:e=>{var{ret:t}=e;t.onHeadersReceived((function n(r){var i=Y.get(e);null==i||i.checkHeader(r),t.offHeadersReceived(n)}))}},e),configurable:!0}})}(),pe(),en(),function(){var e=d(),t=$.ReportScene,n=e.reportScene;n&&Reflect.defineProperty(e,t,{value:e=>(7===e.sceneId&&P.emit(q.ReportInteraction,{costTime:e.costTime,sceneId:e.sceneId}),Q(t,n,void 0,e)),configurable:!0})}(),function(){var e=d(),t=$.OnError,n=e.onError;Reflect.defineProperty(e,t,{value:e=>Q(t,n,void 0,(t=>{P.emit(q.JsError,{message:t.message,stack:t.stack}),e.call(null,t,"")}))})}(),function(){var e=d(),t=$.OnUnhandledRejection,n=e.onUnhandledRejection;Reflect.defineProperty(e,t,{value:e=>Q(t,n,void 0,(t=>{P.emit(q.UnhandledPromiseRejection,{reason:t.reason}),e.call(null,t)}))})}()}}function rn(){Et.getInstance().init(),At.getInstance().init(),qt.getInstance().init(),Ft.getInstance().init(),Dt.getInstance().init(),Mt.getInstance().init(),Ot.getInstance().init(),Wt.getInstance().init(),jt.getInstance().init(),Gt.getInstance().init(),Ht.getInstance().init(),Ut.getInstance().init(),Vt.getInstance().init(),Bt.getInstance().init(),Kt.getInstance().init(),$t.getInstance().init(),Jt.getInstance().init(),Xt.getInstance().init(),Qt.getInstance().init(),zt.getInstance().init()}function sn(){Et.getInstance().off(),At.getInstance().off(),qt.getInstance().off(),Ft.getInstance().off(),Dt.getInstance().off(),Mt.getInstance().off(),Ot.getInstance().off(),Wt.getInstance().off(),jt.getInstance().off(),Gt.getInstance().off(),Ht.getInstance().off(),Ut.getInstance().off(),Vt.getInstance().off(),Bt.getInstance().off(),Kt.getInstance().off(),$t.getInstance().off(),Jt.getInstance().off(),Xt.getInstance().off(),Qt.getInstance().off(),zt.getInstance().off()}function on(){Et.getInstance().clear(),At.getInstance().clear(),qt.getInstance().clear(),Ft.getInstance().clear(),Dt.getInstance().clear(),Mt.getInstance().clear(),Ot.getInstance().clear(),Wt.getInstance().clear(),jt.getInstance().clear(),Gt.getInstance().clear(),Ht.getInstance().clear(),Ut.getInstance().clear(),Vt.getInstance().clear(),Bt.getInstance().clear(),Kt.getInstance().clear(),$t.getInstance().clear(),Jt.getInstance().clear(),Xt.getInstance().clear(),Qt.getInstance().clear(),zt.getInstance().clear()}var an="DETECT_KEY__ENABLE",ln="DETECT_KEY__AUTO_START";class cn extends i{constructor(...e){var n;super(...e),n=this,this.requestId=void 0,this.running=!0,this.interval=2e3,this.supportGamePerformance=!1,this.getGamePerformance=void 0,this.getAndDispatchPerformanceData=t()((function*(){if(n.running){var[,e]=yield g(n.postGetGamePerformance());e&&n.enable&&(delete e.errMsg,P.emit(E,new X(e))),n.running&&(n.requestId=setTimeout((()=>{n.getAndDispatchPerformanceData()}),n.interval))}}))}get enable(){return hn.isRunning&&this.supportGamePerformance}init(e){e?(this.supportGamePerformance=!0,this.getGamePerformance=e):this.supportGamePerformance=!1}start(){this.enable&&(this.running=!0,this.getAndDispatchPerformanceData())}stop(){this.running=!1,this.requestId&&clearTimeout(this.requestId)}postGetGamePerformance(){return this.getGamePerformance?new Promise(((e,t)=>{var n;null===(n=this.getGamePerformance)||void 0===n||n.call(this,{success:e,fail:t})})):Promise.reject()}}const hn=class extends i{constructor(...e){super(...e),this.enable=!1,this.isRunning=!1,this.injectMode=!1,this.autoStart=!1,this.deviceInfo=void 0,this.result=void 0,this.initParams=void 0,this.start=()=>{this.isRunning=!0,V.detectTimes+=1,U.event("minigame detect logic running!!"),V.meta.startTime=Date.now(),k.init(),Pt.getInstance().init(),Lt.getInstance().init(),xt.getInstance().init(),_t.getInstance().init(),rn(),cn.getInstance().start(),P.emit(L)},this.stop=()=>{this.isRunning=!1,P.emit(N),P.emit(x),U.event("minigame detect logic stop!!"),V.meta.endTime=Date.now(),V.isWxApplib&&Xe.report({Type:Ie.Info,Target:be.End,ExternInfo:{detectTime:Date.now()-V.meta.startTime,...Qe()}}),k.stop(),cn.getInstance().stop(),Pt.getInstance().off(),Lt.getInstance().off(),xt.getInstance().off(),_t.getInstance().off(),sn(),Yt.getInstance().uploadReport().then(this.reset)}}init(e){var t;U.event("minigame detect tool inject!!"),U.debug("minigame detect tool inject!!, initParams=",e),V.init(e),Xe=new Ke,this.initParams=e,h(e.globalWx),V.isWxApplib?(this.enable=!0,this.autoStart=V.audits.autoStart):this.handleLaunchConfig(),U.event(`enable=${this.enable}, autoStart=${this.autoStart}`),this.enable&&(V.isWxApplib&&Xe.report({Type:Ie.Info,Target:be.Launch,ExternInfo:{subpackages:V.sdk.WXConfig.subpackages,parallelPreloadSubpackages:V.sdk.WXConfig.parallelPreloadSubpackages,...Qe()}}),this.beforeStart(),this.generateDetectTask(),this.autoStart&&this.start()),t={request:e.request,uploadFile:e.uploadFile,gameTransfer:e.gameTransfer},ot=t.request?t.request:d().request,at=t.uploadFile?t.uploadFile:d().uploadFile,et(t)}generateDetectTask(){return t()((function*(){Yt.getInstance().getDeviceInfo()}))()}handleLaunchConfig(){this.injectMode=!1;var e={};this.enable=!!e[an],this.autoStart=!!e[ln]}registerDetectEvent(){P.once(L,this.start),P.once(x,this.stop)}beforeStart(){var{coverview:e,getGamePerformance:t}=this.initParams;nn(),V.isWxApplib&&(Zt.getInstance().init(e),cn.getInstance().init(t))}reset(){Yt.getInstance().reset(),V.reset(),on(),k.reset(),Pt.getInstance().reset(),Lt.getInstance().reset(),xt.getInstance().reset(),_t.getInstance().reset()}}.getInstance();Object.defineProperty(globalThis,"__GamePerformanceUtilsSDK",{get:()=>({getSDK:()=>({controller:hn,setWx(e){u(e)}})})});const un=hn})(),r.default})()}()}catch(e){console.error("catch sdkSubPackage: gamePerformanceUtilsSDK error: ",e)}